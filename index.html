<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAV 벡터 제조 공정기술 - Interactive eBook</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #3b82f6;
            --text-color: #1f2937;
            --bg-color: #ffffff;
            --sidebar-bg: #f8fafc;
            --border-color: #e5e7eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }

        [data-theme="dark"] {
            --text-color: #f9fafb;
            --bg-color: #111827;
            --sidebar-bg: #1f2937;
            --border-color: #374151;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .sidebar-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Search */
        .search-container {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .search-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Navigation */
        .nav-menu {
            padding: 1rem 0;
        }

        .nav-item {
            margin: 0.25rem 0;
        }

        .nav-link {
            display: block;
            padding: 0.75rem 1.5rem;
            color: var(--text-color);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background-color: rgba(37, 99, 235, 0.1);
            border-left-color: var(--primary-color);
        }

        .nav-link.active {
            background-color: rgba(37, 99, 235, 0.15);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }

        .nav-sub-item {
            padding-left: 2rem;
            font-size: 0.9rem;
        }

        /* Progress */
        .progress-container {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .progress-label {
            font-size: 0.8rem;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 320px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        /* Toolbar */
        .toolbar {
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--sidebar-bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 500;
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toolbar-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        /* Content Area */
        .content-area {
            padding: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .chapter {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .chapter.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chapter-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        .chapter-subtitle {
            font-size: 1.2rem;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin: 2rem 0 1rem 0;
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
        }

        .subsection-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 1.5rem 0 1rem 0;
        }

        .content-text {
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        /* Interactive Elements */
        .interactive-box {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #0284c7;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            position: relative;
        }

        .interactive-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .calculator {
            background-color: var(--bg-color);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .calc-input {
            width: 100%;
            padding: 0.5rem;
            margin: 0.5rem 0;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .calc-result {
            background-color: var(--success-color);
            color: white;
            padding: 0.75rem;
            border-radius: 4px;
            margin-top: 1rem;
            font-weight: 600;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin: 1.5rem 0;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-color);
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--sidebar-bg);
            font-weight: 600;
            color: var(--primary-color);
        }

        tr:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }

        /* Highlight boxes */
        .highlight-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--warning-color);
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .success-box {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-left: 4px solid var(--success-color);
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .warning-box {
            background: linear-gradient(135deg, #fef2f2, #fecaca);
            border-left: 4px solid var(--danger-color);
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        /* Checklist */
        .checklist {
            background-color: var(--sidebar-bg);
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .checklist-item:hover {
            background-color: rgba(37, 99, 235, 0.1);
        }

        .checklist-item input[type="checkbox"] {
            width: 1.2rem;
            height: 1.2rem;
            cursor: pointer;
        }

        .checklist-item.completed {
            background-color: rgba(16, 185, 129, 0.1);
            text-decoration: line-through;
            opacity: 0.7;
        }

        /* Navigation buttons */
        .chapter-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
            transform: none;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .content-area {
                padding: 1rem;
            }
        }

        /* Print styles */
        @media print {
            .sidebar, .toolbar, .chapter-nav {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .chapter {
                display: block !important;
                page-break-before: always;
            }
        }

        /* Animation for interactive elements */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--sidebar-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">AAV 벡터 제조 기술</div>
                <div class="sidebar-subtitle">Interactive eBook</div>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="내용 검색...">
            </div>
            
            <div class="progress-container">
                <div class="progress-label">학습 진행률</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div style="font-size: 0.8rem; margin-top: 0.5rem; text-align: center;" id="progressText">0% 완료</div>
            </div>
            
            <div class="nav-menu" id="navMenu">
                <div class="nav-item">
                    <a href="#" class="nav-link active" data-chapter="intro">📖 서론</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="design">🧬 벡터 설계</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="overview">⚙️ 공정 개요</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="upstream">🧪 상류공정</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="downstream">🔬 하류공정</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="quality">✅ 품질관리</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="gmp">🏭 GMP & 스케일업</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="automation">🤖 자동화 & PAT</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="future">🚀 미래 전망</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="casestudy">📋 사례 연구</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="regulatory">📜 규제 가이드</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="tools">🛠️ 실무 도구</a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-chapter="appendix">📚 부록</a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <div class="toolbar">
                <div class="toolbar-left">
                    <button class="btn" id="toggleSidebar">☰ 메뉴</button>
                    <button class="btn" id="toggleTheme">🌙 다크모드</button>
                </div>
                <div class="toolbar-right">
                    <button class="btn" onclick="window.print()">🖨️ 인쇄</button>
                    <button class="btn" id="bookmarkBtn">🔖 북마크</button>
                    <button class="btn" id="notesBtn">📝 노트</button>
                    <button class="btn" id="quizBtn">🧠 퀴즈</button>
                    <button class="btn" id="summaryBtn">📄 요약</button>
                </div>
            </div>

            <div class="content-area">
                <!-- Chapter: Introduction -->
                <div class="chapter active" id="chapter-intro">
                    <h1 class="chapter-title">제1장 서론</h1>
                    <p class="chapter-subtitle">AAV 벡터의 중요성과 제조 공정의 도전과제</p>
                    
                    <div class="section-title">1.1 AAV 벡터의 중요성</div>
                    <div class="content-text">
                        Adeno-Associated Virus (AAV) 벡터는 현재 유전자 치료 분야에서 가장 각광받는 전달체입니다. 낮은 면역원성, 비병원성, 그리고 다양한 조직에 대한 특이적 감염능력으로 인해 임상에서 광범위하게 활용되고 있습니다.
                    </div>

                    <div class="highlight-box">
                        <strong>💡 주요 장점:</strong><br>
                        • 비병원성 및 낮은 면역원성<br>
                        • 분열하지 않는 세포에도 감염 가능<br>
                        • 장기간 유전자 발현 유지<br>
                        • 다양한 혈청형을 통한 조직 특이성
                    </div>

                    <div class="interactive-box">
                        <div class="interactive-title">📊 시장 현황 분석</div>
                        <div class="calculator">
                            <label>예상 환자 수:</label>
                            <input type="number" class="calc-input" id="patientCount" value="1000" placeholder="환자 수 입력">
                            
                            <label>용량 (dose/환자):</label>
                            <input type="number" class="calc-input" id="dosePerPatient" value="1e15" placeholder="GC/dose">
                            
                            <label>제조 비용 ($/dose):</label>
                            <input type="number" class="calc-input" id="costPerDose" value="100000" placeholder="제조 비용">
                            
                            <button class="btn btn-primary" onclick="calculateMarket()">시장 규모 계산</button>
                            
                            <div class="calc-result" id="marketResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="section-title">1.2 제조 공정의 도전과제</div>
                    <div class="content-text">
                        AAV 벡터 제조는 여러 기술적, 경제적 도전을 안고 있습니다:
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>도전과제</th>
                                    <th>현재 상황</th>
                                    <th>목표</th>
                                    <th>해결 방안</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>스케일업</td>
                                    <td>10-50L</td>
                                    <td>1000-2000L</td>
                                    <td>연속공정, 자동화</td>
                                </tr>
                                <tr>
                                    <td>생산비용</td>
                                    <td>$100K-500K/dose</td>
                                    <td>$10K-50K/dose</td>
                                    <td>공정 최적화, 수율 향상</td>
                                </tr>
                                <tr>
                                    <td>Empty/Full 비율</td>
                                    <td>30-70% Empty</td>
                                    <td><15% Empty</td>
                                    <td>신규 정제 기술</td>
                                </tr>
                                <tr>
                                    <td>품질 일관성</td>
                                    <td>배치 간 편차 ±30%</td>
                                    <td>±10% 이내</td>
                                    <td>PAT, 실시간 모니터링</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="warning-box">
                        <strong>⚠️ 중요 고려사항:</strong><br>
                        AAV 제조는 높은 기술적 복잡성과 규제 요구사항을 수반합니다. 성공적인 상업화를 위해서는 체계적인 공정 개발과 지속적인 최적화가 필수입니다.
                    </div>
                </div>

                <!-- Chapter: Vector Design -->
                <div class="chapter" id="chapter-design">
                    <h1 class="chapter-title">제2장 AAV 벡터의 설계</h1>
                    <p class="chapter-subtitle">효과적인 AAV 벡터 설계를 위한 핵심 요소들</p>
                    
                    <div class="section-title">2.1 혈청형 선택 가이드</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🧬 혈청형 선택 도구</div>
                        <div class="calculator">
                            <label>표적 조직:</label>
                            <select class="calc-input" id="targetTissue">
                                <option value="brain">뇌/중추신경계</option>
                                <option value="liver">간</option>
                                <option value="muscle">근육</option>
                                <option value="eye">눈/망막</option>
                                <option value="lung">폐/기도</option>
                                <option value="heart">심장</option>
                            </select>
                            
                            <label>투여 경로:</label>
                            <select class="calc-input" id="deliveryRoute">
                                <option value="iv">정맥주사 (IV)</option>
                                <option value="local">국소주사</option>
                                <option value="intrathecal">뇌척수강내</option>
                                <option value="inhalation">흡입</option>
                            </select>
                            
                            <button class="btn btn-primary" onclick="recommendSerotype()">혈청형 추천</button>
                            
                            <div class="calc-result" id="serotypeResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>혈청형</th>
                                    <th>주요 표적</th>
                                    <th>BBB 투과성</th>
                                    <th>임상 적용</th>
                                    <th>특징</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>AAV1</td>
                                    <td>근육, 신경</td>
                                    <td>낮음</td>
                                    <td>DMD, 심부전</td>
                                    <td>근육 특이성 우수</td>
                                </tr>
                                <tr>
                                    <td>AAV2</td>
                                    <td>간, 신경, 망막</td>
                                    <td>중간</td>
                                    <td>혈우병B, LCA</td>
                                    <td>가장 연구 많이됨</td>
                                </tr>
                                <tr>
                                    <td>AAV8</td>
                                    <td>간, 근육</td>
                                    <td>낮음</td>
                                    <td>혈우병A/B</td>
                                    <td>간 특이성 높음</td>
                                </tr>
                                <tr>
                                    <td>AAV9</td>
                                    <td>CNS, 심장</td>
                                    <td>높음</td>
                                    <td>SMA, ALS</td>
                                    <td>BBB 투과 우수</td>
                                </tr>
                                <tr>
                                    <td>AAVrh10</td>
                                    <td>기도, 간</td>
                                    <td>중간</td>
                                    <td>낭포성 섬유증</td>
                                    <td>기도 상피 특이성</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">2.2 유전자 카세트 설계</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">📏 카세트 크기 계산기</div>
                        <div class="calculator">
                            <label>ITR (고정):</label>
                            <input type="number" class="calc-input" value="290" readonly> bp
                            
                            <label>프로모터 길이:</label>
                            <input type="number" class="calc-input" id="promoterLength" value="500" placeholder="bp"> bp
                            
                            <label>치료유전자 길이:</label>
                            <input type="number" class="calc-input" id="geneLength" value="1500" placeholder="bp"> bp
                            
                            <label>폴리A 신호:</label>
                            <input type="number" class="calc-input" id="polyALength" value="200" placeholder="bp"> bp
                            
                            <button class="btn btn-primary" onclick="calculateCassetteSize()">총 크기 계산</button>
                            
                            <div class="calc-result" id="cassetteResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="success-box">
                        <strong>✅ 설계 원칙:</strong><br>
                        • 총 카세트 크기는 4.7kb 이하로 제한<br>
                        • ITR로부터 최소 100bp 이격<br>
                        • 강한 2차 구조 형성 서열 회피<br>
                        • Codon optimization 적용
                    </div>
                </div>

                <!-- Chapter: Process Overview -->
                <div class="chapter" id="chapter-overview">
                    <h1 class="chapter-title">제3장 제조 공정 개요</h1>
                    <p class="chapter-subtitle">AAV 벡터 제조의 전체 흐름과 핵심 단계</p>
                    
                    <div class="section-title">3.1 전체 공정 흐름</div>
                    
                    <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px; padding: 2rem; margin: 2rem 0; text-align: center;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                            <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); min-width: 120px;">
                                <div style="font-size: 2rem;">🧫</div>
                                <div style="font-weight: 600; margin: 0.5rem 0;">세포은행</div>
                                <div style="font-size: 0.8rem;">MCB/WCB</div>
                            </div>
                            <div style="font-size: 2rem; color: #2563eb;">→</div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); min-width: 120px;">
                                <div style="font-size: 2rem;">⚙️</div>
                                <div style="font-weight: 600; margin: 0.5rem 0;">상류공정</div>
                                <div style="font-size: 0.8rem;">배양/생산</div>
                            </div>
                            <div style="font-size: 2rem; color: #2563eb;">→</div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); min-width: 120px;">
                                <div style="font-size: 2rem;">🔬</div>
                                <div style="font-weight: 600; margin: 0.5rem 0;">하류공정</div>
                                <div style="font-size: 0.8rem;">정제/농축</div>
                            </div>
                            <div style="font-size: 2rem; color: #2563eb;">→</div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); min-width: 120px;">
                                <div style="font-size: 2rem;">💉</div>
                                <div style="font-weight: 600; margin: 0.5rem 0;">제형화</div>
                                <div style="font-size: 0.8rem;">무균충진</div>
                            </div>
                            <div style="font-size: 2rem; color: #2563eb;">→</div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); min-width: 120px;">
                                <div style="font-size: 2rem;">📦</div>
                                <div style="font-weight: 600; margin: 0.5rem 0;">최종제품</div>
                                <div style="font-size: 0.8rem;">QC/출하</div>
                            </div>
                        </div>
                    </div>

                    <div class="section-title">3.2 공정 전환 단계</div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>단계</th>
                                    <th>규모</th>
                                    <th>주요 목표</th>
                                    <th>검증 요구사항</th>
                                    <th>소요 기간</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>연구 개발</td>
                                    <td>1-10L</td>
                                    <td>개념 증명, 최적화</td>
                                    <td>기초 분석법 개발</td>
                                    <td>6-12개월</td>
                                </tr>
                                <tr>
                                    <td>임상 전</td>
                                    <td>50-200L</td>
                                    <td>GMP 적합성 확인</td>
                                    <td>3배치 연속 성공</td>
                                    <td>3-6개월</td>
                                </tr>
                                <tr>
                                    <td>임상 I/II</td>
                                    <td>200-500L</td>
                                    <td>환자 치료용 생산</td>
                                    <td>완전한 validation</td>
                                    <td>6-12개월</td>
                                </tr>
                                <tr>
                                    <td>상업 생산</td>
                                    <td>1000-2000L</td>
                                    <td>대량 생산 체계</td>
                                    <td>PPQ, 지속적 검증</td>
                                    <td>12-18개월</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="interactive-box">
                        <div class="interactive-title">📈 스케일업 시뮬레이터</div>
                        <div class="calculator">
                            <label>현재 규모 (L):</label>
                            <input type="number" class="calc-input" id="currentScale" value="50" placeholder="현재 배양 규모">
                            
                            <label>목표 규모 (L):</label>
                            <input type="number" class="calc-input" id="targetScale" value="500" placeholder="목표 배양 규모">
                            
                            <label>현재 수율 (GC/L):</label>
                            <input type="number" class="calc-input" id="currentYield" value="1e12" placeholder="현재 수율">
                            
                            <button class="btn btn-primary" onclick="calculateScaleup()">스케일업 분석</button>
                            
                            <div class="calc-result" id="scaleupResult" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Chapter: Upstream -->
                <div class="chapter" id="chapter-upstream">
                    <h1 class="chapter-title">제4장 상류공정</h1>
                    <p class="chapter-subtitle">세포 배양부터 AAV 생산까지의 핵심 기술</p>
                    
                    <div class="section-title">4.1 HEK293 Suspension 배양</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🧪 배양 조건 최적화 도구</div>
                        <div class="calculator">
                            <label>배양 부피 (L):</label>
                            <input type="number" class="calc-input" id="cultureVolume" value="200" placeholder="총 배양 부피">
                            
                            <label>초기 세포밀도 (×10⁶ cells/mL):</label>
                            <input type="number" class="calc-input" id="initialDensity" value="0.5" placeholder="접종 밀도">
                            
                            <label>목표 세포밀도 (×10⁶ cells/mL):</label>
                            <input type="number" class="calc-input" id="targetDensity" value="2.0" placeholder="Transfection 시점">
                            
                            <label>배가 시간 (hours):</label>
                            <input type="number" class="calc-input" id="doublingTime" value="24" placeholder="세포 배가 시간">
                            
                            <button class="btn btn-primary" onclick="calculateCulture()">배양 계획 수립</button>
                            
                            <div class="calc-result" id="cultureResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>파라미터</th>
                                    <th>최적 범위</th>
                                    <th>허용 범위</th>
                                    <th>모니터링 주기</th>
                                    <th>조치 기준</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>용존산소 (DO)</td>
                                    <td>30-50%</td>
                                    <td>20-60%</td>
                                    <td>연속</td>
                                    <td>±10% 벗어나면 조정</td>
                                </tr>
                                <tr>
                                    <td>pH</td>
                                    <td>7.0-7.4</td>
                                    <td>6.8-7.6</td>
                                    <td>연속</td>
                                    <td>±0.2 벗어나면 조정</td>
                                </tr>
                                <tr>
                                    <td>온도 (°C)</td>
                                    <td>36.5-37.5</td>
                                    <td>36.0-38.0</td>
                                    <td>연속</td>
                                    <td>±1°C 벗어나면 확인</td>
                                </tr>
                                <tr>
                                    <td>교반속도 (rpm)</td>
                                    <td>60-100</td>
                                    <td>40-120</td>
                                    <td>연속</td>
                                    <td>거품 발생 시 감소</td>
                                </tr>
                                <tr>
                                    <td>생존율 (%)</td>
                                    <td>>95</td>
                                    <td>>90</td>
                                    <td>매일</td>
                                    <td><90% 시 원인 조사</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">4.2 Triple Transfection 최적화</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🔬 Transfection 계산기</div>
                        <div class="calculator">
                            <label>배양 부피 (mL):</label>
                            <input type="number" class="calc-input" id="transfectionVolume" value="200000" placeholder="Transfection 부피">
                            
                            <label>세포밀도 (×10⁶ cells/mL):</label>
                            <input type="number" class="calc-input" id="cellDensity" value="2.0" placeholder="Transfection 시점 밀도">
                            
                            <label>DNA 농도 (μg/mL):</label>
                            <input type="number" class="calc-input" id="dnaConcentration" value="1.0" placeholder="총 DNA 농도">
                            
                            <button class="btn btn-primary" onclick="calculateTransfection()">Transfection 레시피 계산</button>
                            
                            <div class="calc-result" id="transfectionResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <strong>🎯 Transfection 최적화 포인트:</strong><br>
                        • Vector:Rep/Cap:Helper = 1:1:2 비율 권장<br>
                        • 세포밀도 1.5-2.0 × 10⁶ cells/mL에서 실시<br>
                        • PEI:DNA 비율 = 3:1 (w/w)<br>
                        • 복합체 형성 시간: 15-20분<br>
                        • Transfection 후 온도 shift: 37°C → 32-34°C
                    </div>

                    <div class="section-title">4.3 Fed-Batch 전략</div>
                    
                    <div class="checklist">
                        <h4>Feed 스케줄 체크리스트</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="feed1">
                            <label for="feed1">Day 0: 초기 접종 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="feed2">
                            <label for="feed2">Day 1: Transfection 실시</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="feed3">
                            <label for="feed3">Day 2: 첫 번째 Feed (5% v/v)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="feed4">
                            <label for="feed4">Day 3: 두 번째 Feed (5% v/v)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="feed5">
                            <label for="feed5">Day 4: 수율 확인 및 Harvest 준비</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="feed6">
                            <label for="feed6">Day 5: Harvest 실시</label>
                        </div>
                    </div>
                </div>

                <!-- Chapter: Downstream -->
                <div class="chapter" id="chapter-downstream">
                    <h1 class="chapter-title">제5장 하류공정</h1>
                    <p class="chapter-subtitle">효율적인 AAV 정제를 위한 전략과 기술</p>
                    
                    <div class="section-title">5.1 Harvest & Clarification</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🔧 용해 조건 최적화</div>
                        <div class="calculator">
                            <label>배양 부피 (L):</label>
                            <input type="number" class="calc-input" id="harvestVolume" value="200" placeholder="Harvest 부피">
                            
                            <label>세포밀도 (×10⁶ cells/mL):</label>
                            <input type="number" class="calc-input" id="harvestDensity" value="3.0" placeholder="Harvest 시점 밀도">
                            
                            <label>용해 방법:</label>
                            <select class="calc-input" id="lysisMethod">
                                <option value="triton">Triton X-100</option>
                                <option value="freeze">Freeze-thaw</option>
                                <option value="detergent">기타 Detergent</option>
                            </select>
                            
                            <button class="btn btn-primary" onclick="calculateLysis()">용해 조건 계산</button>
                            
                            <div class="calc-result" id="lysisResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>정제 단계</th>
                                    <th>목적</th>
                                    <th>주요 제거 대상</th>
                                    <th>예상 수율</th>
                                    <th>소요 시간</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Clarification</td>
                                    <td>세포 잔해 제거</td>
                                    <td>세포, 핵산, 세포기질</td>
                                    <td>90-95%</td>
                                    <td>2-4시간</td>
                                </tr>
                                <tr>
                                    <td>Affinity Capture</td>
                                    <td>AAV 농축/포집</td>
                                    <td>HCP, 배지 성분</td>
                                    <td>75-85%</td>
                                    <td>4-6시간</td>
                                </tr>
                                <tr>
                                    <td>Ion Exchange</td>
                                    <td>불순물 제거</td>
                                    <td>HCP, DNA, Empty capsids</td>
                                    <td>80-90%</td>
                                    <td>3-5시간</td>
                                </tr>
                                <tr>
                                    <td>Size Exclusion</td>
                                    <td>응집체 제거</td>
                                    <td>Aggregates, 저분자</td>
                                    <td>85-95%</td>
                                    <td>2-3시간</td>
                                </tr>
                                <tr>
                                    <td>TFF</td>
                                    <td>농축/Buffer 교환</td>
                                    <td>염, 저분자 불순물</td>
                                    <td>90-95%</td>
                                    <td>2-4시간</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">5.2 Chromatography 최적화</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">📊 컬럼 사이징 계산기</div>
                        <div class="calculator">
                            <label>처리량 (L):</label>
                            <input type="number" class="calc-input" id="columnVolume" value="200" placeholder="처리할 용액 부피">
                            
                            <label>AAV 농도 (×10¹² GC/L):</label>
                            <input type="number" class="calc-input" id="aavConcentration" value="1.0" placeholder="AAV 농도">
                            
                            <label>수지 결합용량 (×10¹³ GC/L resin):</label>
                            <input type="number" class="calc-input" id="resinCapacity" value="1.0" placeholder="수지 결합용량">
                            
                            <label>목표 유속 (CV/h):</label>
                            <input type="number" class="calc-input" id="flowRate" value="150" placeholder="유속">
                            
                            <button class="btn btn-primary" onclick="calculateColumn()">컬럼 크기 계산</button>
                            
                            <div class="calc-result" id="columnResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="warning-box">
                        <strong>⚠️ 스케일업 주의사항:</strong><br>
                        • 압력 증가: 높이 증가 시 압력 증가 고려<br>
                        • 유속 균일성: 컬럼 직경 대비 높이 비율 유지<br>
                        • 온도 제어: 대형 컬럼에서 온도 균일성 확보<br>
                        • 세척 검증: 스케일업 시 세척 효율 재검증 필수
                    </div>

                    <div class="section-title">5.3 Empty/Full Capsid 분리</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">⚖️ Empty/Full 비율 시뮬레이터</div>
                        <div class="calculator">
                            <label>초기 Full capsid % :</label>
                            <input type="number" class="calc-input" id="initialFull" value="60" placeholder="정제 전 Full %">
                            
                            <label>분리 효율 % :</label>
                            <input type="number" class="calc-input" id="separationEfficiency" value="80" placeholder="분리 공정 효율">
                            
                            <label>수율 % :</label>
                            <input type="number" class="calc-input" id="recoveryYield" value="75" placeholder="전체 회수율">
                            
                            <button class="btn btn-primary" onclick="calculateEmptyFull()">분리 결과 예측</button>
                            
                            <div class="calc-result" id="emptyFullResult" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Chapter: Quality -->
                <div class="chapter" id="chapter-quality">
                    <h1 class="chapter-title">제6장 품질 특성 및 분석</h1>
                    <p class="chapter-subtitle">AAV 제품의 품질 보증을 위한 분석 전략</p>
                    
                    <div class="section-title">6.1 필수 품질 속성 (CQAs)</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🔬 qPCR 역가 계산기</div>
                        <div class="calculator">
                            <label>Ct 값:</label>
                            <input type="number" class="calc-input" id="ctValue" value="25.5" placeholder="qPCR Ct 값" step="0.1">
                            
                            <label>표준곡선 기울기:</label>
                            <input type="number" class="calc-input" id="slope" value="-3.32" placeholder="Standard curve slope" step="0.01">
                            
                            <label>Y 절편:</label>
                            <input type="number" class="calc-input" id="intercept" value="40.0" placeholder="Y-intercept" step="0.1">
                            
                            <label>희석 배수:</label>
                            <input type="number" class="calc-input" id="dilution" value="1000" placeholder="샘플 희석 배수">
                            
                            <button class="btn btn-primary" onclick="calculateTiter()">역가 계산</button>
                            
                            <div class="calc-result" id="titerResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>품질 속성</th>
                                    <th>분석 방법</th>
                                    <th>규격 기준</th>
                                    <th>분석 시간</th>
                                    <th>빈도</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>AAV 역가</td>
                                    <td>qPCR (ITR)</td>
                                    <td>1×10¹²-1×10¹⁴ GC/mL</td>
                                    <td>4시간</td>
                                    <td>모든 배치</td>
                                </tr>
                                <tr>
                                    <td>Full/Empty 비율</td>
                                    <td>AUC, CryoEM</td>
                                    <td>Full >70%</td>
                                    <td>24시간</td>
                                    <td>출하 시</td>
                                </tr>
                                <tr>
                                    <td>동일성</td>
                                    <td>PCR, 시퀀싱</td>
                                    <td>100% 일치</td>
                                    <td>8시간</td>
                                    <td>출하 시</td>
                                </tr>
                                <tr>
                                    <td>순도</td>
                                    <td>SDS-PAGE, HPLC</td>
                                    <td>주성분 >90%</td>
                                    <td>6시간</td>
                                    <td>모든 배치</td>
                                </tr>
                                <tr>
                                    <td>HCP</td>
                                    <td>ELISA</td>
                                    <td><100 ng/dose</td>
                                    <td>6시간</td>
                                    <td>모든 배치</td>
                                </tr>
                                <tr>
                                    <td>잔류 DNA</td>
                                    <td>qPCR</td>
                                    <td><10 ng/dose</td>
                                    <td>4시간</td>
                                    <td>모든 배치</td>
                                </tr>
                                <tr>
                                    <td>Endotoxin</td>
                                    <td>LAL</td>
                                    <td><5 EU/kg</td>
                                    <td>1시간</td>
                                    <td>모든 배치</td>
                                </tr>
                                <tr>
                                    <td>무균성</td>
                                    <td>USP <71></td>
                                    <td>음성</td>
                                    <td>14일</td>
                                    <td>모든 배치</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">6.2 안정성 시험</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">📈 안정성 예측 모델</div>
                        <div class="calculator">
                            <label>초기 역가 (log GC/mL):</label>
                            <input type="number" class="calc-input" id="initialTiter" value="13.0" placeholder="Initial titer" step="0.1">
                            
                            <label>보관 온도 (°C):</label>
                            <select class="calc-input" id="storageTemp">
                                <option value="-80">-80°C (장기보관)</option>
                                <option value="-20">-20°C (중기보관)</option>
                                <option value="4">4°C (단기보관)</option>
                                <option value="25">25°C (스트레스)</option>
                            </select>
                            
                            <label>보관 기간 (개월):</label>
                            <input type="number" class="calc-input" id="storagePeriod" value="12" placeholder="보관 기간">
                            
                            <button class="btn btn-primary" onclick="calculateStability()">안정성 예측</button>
                            
                            <div class="calc-result" id="stabilityResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="success-box">
                        <strong>✅ 안정성 가이드라인:</strong><br>
                        • -80°C: 24개월 이상 안정<br>
                        • -20°C: 12개월 안정<br>
                        • 2-8°C: 1-3개월 안정<br>
                        • 25°C: 1주일 이내<br>
                        • 동결해동: 3회까지 허용
                    </div>

                    <div class="section-title">6.3 분석법 밸리데이션</div>
                    
                    <div class="checklist">
                        <h4>분석법 밸리데이션 체크리스트</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="val1">
                            <label for="val1">정확도 (Accuracy): 회수율 95-105%</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="val2">
                            <label for="val2">정밀도 (Precision): CV <15%</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="val3">
                            <label for="val3">직선성 (Linearity): R² >0.99</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="val4">
                            <label for="val4">범위 (Range): 50-150% 농도</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="val5">
                            <label for="val5">검출한계 (LOD): S/N >3</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="val6">
                            <label for="val6">정량한계 (LOQ): S/N >10</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="val7">
                            <label for="val7">견고성 (Robustness): 조건 변화 대응</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="val8">
                            <label for="val8">특이성 (Specificity): 간섭물질 부재</label>
                        </div>
                    </div>
                </div>

                <!-- Chapter: GMP -->
                <div class="chapter" id="chapter-gmp">
                    <h1 class="chapter-title">제7장 GMP 및 스케일업 전략</h1>
                    <p class="chapter-subtitle">규제 준수와 상업적 생산을 위한 전략</p>
                    
                    <div class="section-title">7.1 GMP 시설 설계</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🏭 시설 면적 계산기</div>
                        <div class="calculator">
                            <label>연간 생산 목표 (배치 수):</label>
                            <input type="number" class="calc-input" id="annualBatches" value="50" placeholder="연간 배치 수">
                            
                            <label>배치당 처리 시간 (일):</label>
                            <input type="number" class="calc-input" id="batchCycleTime" value="10" placeholder="총 공정 시간">
                            
                            <label>동시 진행 라인 수:</label>
                            <input type="number" class="calc-input" id="parallelLines" value="2" placeholder="생산 라인 수">
                            
                            <label>배치 크기 (L):</label>
                            <input type="number" class="calc-input" id="facilityBatchSize" value="500" placeholder="배치 크기">
                            
                            <button class="btn btn-primary" onclick="calculateFacility()">시설 요구사항 계산</button>
                            
                            <div class="calc-result" id="facilityResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>청정도 등급</th>
                                    <th>용도</th>
                                    <th>입자수 (≥0.5μm/m³)</th>
                                    <th>차압 (Pa)</th>
                                    <th>환기횟수 (/h)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Grade A</td>
                                    <td>무균 조작</td>
                                    <td>3,520</td>
                                    <td>+15</td>
                                    <td>20+ (단방향)</td>
                                </tr>
                                <tr>
                                    <td>Grade B</td>
                                    <td>무균 조립</td>
                                    <td>3,520</td>
                                    <td>+10</td>
                                    <td>20+</td>
                                </tr>
                                <tr>
                                    <td>Grade C</td>
                                    <td>제조 구역</td>
                                    <td>352,000</td>
                                    <td>+5</td>
                                    <td>15-20</td>
                                </tr>
                                <tr>
                                    <td>Grade D</td>
                                    <td>보조 구역</td>
                                    <td>3,520,000</td>
                                    <td>0</td>
                                    <td>10-15</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">7.2 공정 검증 (Process Validation)</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">📊 공정 능력 평가</div>
                        <div class="calculator">
                            <label>공정 평균값:</label>
                            <input type="number" class="calc-input" id="processMean" value="85" placeholder="공정 평균" step="0.1">
                            
                            <label>표준편차:</label>
                            <input type="number" class="calc-input" id="processStd" value="3.5" placeholder="표준편차" step="0.1">
                            
                            <label>규격 하한 (LSL):</label>
                            <input type="number" class="calc-input" id="lsl" value="70" placeholder="하한값">
                            
                            <label>규격 상한 (USL):</label>
                            <input type="number" class="calc-input" id="usl" value="100" placeholder="상한값">
                            
                            <button class="btn btn-primary" onclick="calculateCpk()">공정 능력 계산</button>
                            
                            <div class="calc-result" id="cpkResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <strong>📋 PPQ (Process Performance Qualification) 요구사항:</strong><br>
                        • 연속 3배치 성공적 생산<br>
                        • 모든 CQA 규격 내 결과<br>
                        • 공정 능력지수 Cpk >1.33<br>
                        • 수율 목표값 달성<br>
                        • 불순물 허용기준 준수
                    </div>

                    <div class="section-title">7.3 위험 관리 (Risk Management)</div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>위험 요소</th>
                                    <th>발생 가능성</th>
                                    <th>심각도</th>
                                    <th>위험도</th>
                                    <th>완화 전략</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>세포주 오염</td>
                                    <td>낮음 (2)</td>
                                    <td>높음 (9)</td>
                                    <td>18</td>
                                    <td>무균 조작, 환경 모니터링</td>
                                </tr>
                                <tr>
                                    <td>Transfection 실패</td>
                                    <td>중간 (5)</td>
                                    <td>중간 (6)</td>
                                    <td>30</td>
                                    <td>시약 품질 관리, 교육</td>
                                </tr>
                                <tr>
                                    <td>정제 컬럼 오염</td>
                                    <td>중간 (4)</td>
                                    <td>높음 (8)</td>
                                    <td>32</td>
                                    <td>CIP/SIP 검증, 수명 관리</td>
                                </tr>
                                <tr>
                                    <td>장비 고장</td>
                                    <td>중간 (5)</td>
                                    <td>중간 (7)</td>
                                    <td>35</td>
                                    <td>예방 정비, 백업 장비</td>
                                </tr>
                                <tr>
                                    <td>품질 규격 이탈</td>
                                    <td>높음 (6)</td>
                                    <td>높음 (8)</td>
                                    <td>48</td>
                                    <td>실시간 모니터링, PAT</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Chapter: Automation -->
                <div class="chapter" id="chapter-automation">
                    <h1 class="chapter-title">제8장 공정 분석기술(PAT) 및 자동화</h1>
                    <p class="chapter-subtitle">스마트 제조를 위한 첨단 기술 적용</p>
                    
                    <div class="section-title">8.1 실시간 모니터링 시스템</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">📡 센서 ROI 계산기</div>
                        <div class="calculator">
                            <label>연간 배치 수:</label>
                            <input type="number" class="calc-input" id="sensorBatches" value="100" placeholder="연간 배치 수">
                            
                            <label>배치당 가치 ($):</label>
                            <input type="number" class="calc-input" id="batchValue" value="500000" placeholder="배치 가치">
                            
                            <label>실패율 개선 (%):</label>
                            <input type="number" class="calc-input" id="failureReduction" value="15" placeholder="실패율 감소">
                            
                            <label>센서 시스템 비용 ($):</label>
                            <input type="number" class="calc-input" id="sensorCost" value="200000" placeholder="초기 투자">
                            
                            <button class="btn btn-primary" onclick="calculateROI()">ROI 계산</button>
                            
                            <div class="calc-result" id="roiResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>센서 유형</th>
                                    <th>측정 항목</th>
                                    <th>정확도</th>
                                    <th>응답 시간</th>
                                    <th>비용 ($)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>NIR 분광계</td>
                                    <td>Glucose, Lactate</td>
                                    <td>±5%</td>
                                    <td><1분</td>
                                    <td>50,000-100,000</td>
                                </tr>
                                <tr>
                                    <td>Raman 분광계</td>
                                    <td>아미노산, pH</td>
                                    <td>±3%</td>
                                    <td><30초</td>
                                    <td>80,000-150,000</td>
                                </tr>
                                <tr>
                                    <td>Capacitance 센서</td>
                                    <td>세포밀도</td>
                                    <td>±10%</td>
                                    <td>연속</td>
                                    <td>15,000-30,000</td>
                                </tr>
                                <tr>
                                    <td>Image 분석기</td>
                                    <td>세포수, 크기</td>
                                    <td>±5%</td>
                                    <td>1-5분</td>
                                    <td>100,000-200,000</td>
                                </tr>
                                <tr>
                                    <td>Mass spectrometer</td>
                                    <td>대사물질</td>
                                    <td>±1%</td>
                                    <td>5-10분</td>
                                    <td>200,000-500,000</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">8.2 인공지능 응용</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🤖 AI 예측 모델 시뮬레이터</div>
                        <div class="calculator">
                            <label>현재 세포밀도 (×10⁶ cells/mL):</label>
                            <input type="number" class="calc-input" id="aiCellDensity" value="2.5" placeholder="현재 밀도" step="0.1">
                            
                            <label>생존율 (%):</label>
                            <input type="number" class="calc-input" id="aiViability" value="92" placeholder="현재 생존율">
                            
                            <label>Glucose 농도 (g/L):</label>
                            <input type="number" class="calc-input" id="aiGlucose" value="1.5" placeholder="현재 포도당 농도" step="0.1">
                            
                            <label>감염 후 시간 (hours):</label>
                            <input type="number" class="calc-input" id="aiPostInfection" value="48" placeholder="감염 후 시간">
                            
                            <button class="btn btn-primary" onclick="predictHarvest()">Harvest 시점 예측</button>
                            
                            <div class="calc-result" id="aiPredictionResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <strong>🎯 AI 적용 분야:</strong><br>
                        • 최적 Harvest 시점 예측<br>
                        • 배치 품질 조기 예측<br>
                        • 공정 편차 자동 감지<br>
                        • 수율 최적화 조건 제안<br>
                        • 예측 유지보수 스케줄링
                    </div>

                    <div class="section-title">8.3 자동화 레벨</div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>자동화 레벨</th>
                                    <th>설명</th>
                                    <th>적용 범위</th>
                                    <th>투자 비용</th>
                                    <th>ROI 기간</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Level 1</td>
                                    <td>기본 제어</td>
                                    <td>pH, DO, 온도</td>
                                    <td>낮음</td>
                                    <td>1-2년</td>
                                </tr>
                                <tr>
                                    <td>Level 2</td>
                                    <td>공정 모니터링</td>
                                    <td>실시간 분석</td>
                                    <td>중간</td>
                                    <td>2-3년</td>
                                </tr>
                                <tr>
                                    <td>Level 3</td>
                                    <td>고급 제어</td>
                                    <td>Feed 제어, 수율 최적화</td>
                                    <td>높음</td>
                                    <td>3-4년</td>
                                </tr>
                                <tr>
                                    <td>Level 4</td>
                                    <td>AI 기반 제어</td>
                                    <td>전체 공정 자율화</td>
                                    <td>매우 높음</td>
                                    <td>4-5년</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">8.4 디지털 트윈</div>
                    
                    <div class="checklist">
                        <h4>디지털 트윈 구현 체크리스트</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="dt1">
                            <label for="dt1">물리적 공정 모델링 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="dt2">
                            <label for="dt2">실시간 데이터 연결 구축</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="dt3">
                            <label for="dt3">가상 센서 네트워크 구성</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="dt4">
                            <label for="dt4">예측 알고리즘 개발</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="dt5">
                            <label for="dt5">시뮬레이션 엔진 통합</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="dt6">
                            <label for="dt6">최적화 모듈 구현</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="dt7">
                            <label for="dt7">사용자 인터페이스 개발</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="dt8">
                            <label for="dt8">검증 및 교정 완료</label>
                        </div>
                    </div>
                </div>

                <!-- Chapter: Future -->
                <div class="chapter" id="chapter-future">
                    <h1 class="chapter-title">제9장 최신 기술 동향과 전망</h1>
                    <p class="chapter-subtitle">AAV 제조 기술의 미래와 혁신 방향</p>
                    
                    <div class="section-title">9.1 차세대 캡시드 개발</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🧬 캡시드 개발 ROI 예측</div>
                        <div class="calculator">
                            <label>개발 비용 ($M):</label>
                            <input type="number" class="calc-input" id="developmentCost" value="10" placeholder="개발 투자 비용">
                            
                            <label>효율 개선 배수:</label>
                            <input type="number" class="calc-input" id="efficiencyGain" value="5" placeholder="표적 특이성 개선" step="0.1">
                            
                            <label>시장 크기 ($M):</label>
                            <input type="number" class="calc-input" id="marketSize" value="500" placeholder="대상 시장 규모">
                            
                            <label>시장 점유율 (%):</label>
                            <input type="number" class="calc-input" id="marketShare" value="20" placeholder="예상 점유율">
                            
                            <button class="btn btn-primary" onclick="calculateCapsidROI()">개발 ROI 계산</button>
                            
                            <div class="calc-result" id="capsidROIResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>차세대 캡시드</th>
                                    <th>개발 기관</th>
                                    <th>주요 특징</th>
                                    <th>임상 단계</th>
                                    <th>상업화 예상</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>AAV-PHP.eB</td>
                                    <td>Caltech/Voyager</td>
                                    <td>BBB 투과 40x 향상</td>
                                    <td>Phase I/II</td>
                                    <td>2026-2027</td>
                                </tr>
                                <tr>
                                    <td>MyoAAV</td>
                                    <td>Harvard/Pfizer</td>
                                    <td>심근 특이성 5x 증가</td>
                                    <td>Preclinical</td>
                                    <td>2027-2028</td>
                                </tr>
                                <tr>
                                    <td>LK03</td>
                                    <td>UPenn</td>
                                    <td>간 특이성, Detargeting</td>
                                    <td>Phase I</td>
                                    <td>2025-2026</td>
                                </tr>
                                <tr>
                                    <td>7m8</td>
                                    <td>UNC</td>
                                    <td>망막 투과성</td>
                                    <td>Preclinical</td>
                                    <td>2026-2027</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">9.2 연속공정 기술</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🔄 연속공정 경제성 분석</div>
                        <div class="calculator">
                            <label>배치 공정 수율 (%):</label>
                            <input type="number" class="calc-input" id="batchYield" value="65" placeholder="기존 배치 수율">
                            
                            <label>연속 공정 수율 (%):</label>
                            <input type="number" class="calc-input" id="continuousYield" value="85" placeholder="연속공정 수율">
                            
                            <label>운영 시간 증가 (%):</label>
                            <input type="number" class="calc-input" id="uptimeImprovement" value="40" placeholder="가동률 향상">
                            
                            <label>초기 투자 증가 (%):</label>
                            <input type="number" class="calc-input" id="capexIncrease" value="50" placeholder="CAPEX 증가">
                            
                            <button class="btn btn-primary" onclick="calculateContinuous()">연속공정 분석</button>
                            
                            <div class="calc-result" id="continuousResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="section-title">9.3 혁신 기술 로드맵</div>
                    
                    <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px; padding: 2rem; margin: 2rem 0;">
                        <h4 style="text-align: center; margin-bottom: 2rem; color: var(--primary-color);">기술 발전 타임라인</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <h5 style="color: var(--primary-color); margin-bottom: 1rem;">2025-2026</h5>
                                <ul style="list-style: none; padding: 0;">
                                    <li>✅ AAVX 플랫폼 표준화</li>
                                    <li>✅ 연속 크로마토그래피</li>
                                    <li>✅ AI 기반 공정 제어</li>
                                    <li>✅ 차세대 캡시드 임상</li>
                                </ul>
                            </div>
                            <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <h5 style="color: var(--primary-color); margin-bottom: 1rem;">2027-2028</h5>
                                <ul style="list-style: none; padding: 0;">
                                    <li>🔄 완전 연속공정</li>
                                    <li>🔄 무세포 생산 시스템</li>
                                    <li>🔄 실시간 품질 관리</li>
                                    <li>🔄 개인맞춤형 AAV</li>
                                </ul>
                            </div>
                            <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <h5 style="color: var(--primary-color); margin-bottom: 1rem;">2029-2030</h5>
                                <ul style="list-style: none; padding: 0;">
                                    <li>🚀 자율 제조 시설</li>
                                    <li>🚀 분산 생산 네트워크</li>
                                    <li>🚀 비용 90% 절감</li>
                                    <li>🚀 1일 내 생산</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="section-title">9.4 규제 환경 변화</div>
                    
                    <div class="highlight-box">
                        <strong>📋 주요 규제 동향 (2025-2030):</strong><br>
                        • Real-Time Release Testing (RTRT) 확대<br>
                        • 연속공정에 대한 ICH Q13 가이드라인<br>
                        • AI/ML 활용 승인 가속화<br>
                        • Digital Twin 기반 규제 제출<br>
                        • 글로벌 조화된 CMC 기준
                    </div>

                    <div class="warning-box">
                        <strong>⚠️ 미래 도전과제:</strong><br>
                        • 개인맞춤형 치료제 규제 프레임워크<br>
                        • 대량 생산 시 품질 일관성 유지<br>
                        • 신속한 기술 변화에 대한 규제 적응<br>
                        • 국제적 공급망 관리<br>
                        • 사이버 보안 및 데이터 보호
                    </div>

                    <div class="section-title">9.5 비용 절감 전망</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">💰 미래 비용 예측 모델</div>
                        <div class="calculator">
                            <label>현재 제조비용 ($/dose):</label>
                            <input type="number" class="calc-input" id="currentCost" value="250000" placeholder="현재 비용">
                            
                            <label>목표 연도:</label>
                            <select class="calc-input" id="targetYear">
                                <option value="2026">2026</option>
                                <option value="2028">2028</option>
                                <option value="2030">2030</option>
                            </select>
                            
                            <label>기술 도입률 (%):</label>
                            <input type="number" class="calc-input" id="adoptionRate" value="80" placeholder="신기술 도입률">
                            
                            <button class="btn btn-primary" onclick="predictCostReduction()">비용 예측</button>
                            
                            <div class="calc-result" id="costPredictionResult" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Chapter: Tools -->
                <div class="chapter" id="chapter-tools">
                    <h1 class="chapter-title">실무 도구</h1>
                    <p class="chapter-subtitle">AAV 제조를 위한 실용적인 계산 도구와 체크리스트</p>
                    
                    <div class="section-title">🧮 통합 계산 도구</div>
                    <div class="interactive-box">
                        <div class="interactive-title">💰 종합 경제성 분석</div>
                        <div class="calculator">
                            <label>배치 크기 (L):</label>
                            <input type="number" class="calc-input" id="batchSize" value="200" placeholder="배양 부피">
                            
                            <label>수율 (GC/mL):</label>
                            <input type="number" class="calc-input" id="yield" value="1e12" placeholder="바이러스 수율">
                            
                            <label>배치당 비용 ($):</label>
                            <input type="number" class="calc-input" id="batchCost" value="50000" placeholder="총 제조 비용">
                            
                            <label>환자당 용량 (GC):</label>
                            <input type="number" class="calc-input" id="patientDose" value="1e15" placeholder="치료용량">
                            
                            <button class="btn btn-primary" onclick="calculateEconomics()">경제성 분석</button>
                            
                            <div class="calc-result" id="economicsResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="section-title">✅ 마스터 체크리스트</div>
                    <div class="checklist">
                        <h4>GMP 생산 마스터 체크리스트</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="check1">
                            <label for="check1">MCB/WCB 품질 확인 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check2">
                            <label for="check2">플라스미드 QC 시험 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check3">
                            <label for="check3">배양 장비 교정 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check4">
                            <label for="check4">정제 컬럼 사전 검증 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check5">
                            <label for="check5">분석 방법 validation 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check6">
                            <label for="check6">작업자 교육 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check7">
                            <label for="check7">환경 모니터링 시작</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check8">
                            <label for="check8">배치 기록 준비 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check9">
                            <label for="check9">QC 실험실 준비 완료</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check10">
                            <label for="check10">출하 승인 체계 확립</label>
                        </div>
                    </div>

                    <div class="section-title">📊 종합 품질 기준표</div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>품질 속성</th>
                                    <th>시험 방법</th>
                                    <th>허용 기준</th>
                                    <th>목표값</th>
                                    <th>중요도</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>바이러스 역가</td>
                                    <td>qPCR</td>
                                    <td>≥1×10¹² GC/mL</td>
                                    <td>≥1×10¹³ GC/mL</td>
                                    <td>Critical</td>
                                </tr>
                                <tr>
                                    <td>Full capsid %</td>
                                    <td>AUC</td>
                                    <td>≥70%</td>
                                    <td>≥85%</td>
                                    <td>Critical</td>
                                </tr>
                                <tr>
                                    <td>Host Cell DNA</td>
                                    <td>qPCR</td>
                                    <td><10 ng/dose</td>
                                    <td><1 ng/dose</td>
                                    <td>Critical</td>
                                </tr>
                                <tr>
                                    <td>Host Cell Protein</td>
                                    <td>ELISA</td>
                                    <td><100 ng/dose</td>
                                    <td><10 ng/dose</td>
                                    <td>Major</td>
                                </tr>
                                <tr>
                                    <td>Endotoxin</td>
                                    <td>LAL</td>
                                    <td><5 EU/kg</td>
                                    <td><0.5 EU/mL</td>
                                    <td>Critical</td>
                                </tr>
                                <tr>
                                    <td>무균성</td>
                                    <td>USP 71</td>
                                    <td>음성</td>
                                    <td>음성</td>
                                    <td>Critical</td>
                                </tr>
                                <tr>
                                    <td>Mycoplasma</td>
                                    <td>PCR/Culture</td>
                                    <td>음성</td>
                                    <td>음성</td>
                                    <td>Critical</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">🔧 문제 해결 가이드</div>
                    <div class="interactive-box">
                        <div class="interactive-title">🚨 트러블슈팅 도구</div>
                        <div class="calculator">
                            <label>문제 유형:</label>
                            <select class="calc-input" id="problemType">
                                <option value="low_yield">낮은 수율</option>
                                <option value="high_empty">높은 Empty capsid 비율</option>
                                <option value="contamination">오염</option>
                                <option value="aggregation">응집</option>
                                <option value="poor_recovery">낮은 회수율</option>
                            </select>
                            
                            <label>발생 단계:</label>
                            <select class="calc-input" id="problemStage">
                                <option value="upstream">상류공정</option>
                                <option value="downstream">하류공정</option>
                                <option value="formulation">제형화</option>
                                <option value="storage">보관</option>
                            </select>
                            
                            <button class="btn btn-primary" onclick="troubleshoot()">해결방안 제시</button>
                            
                            <div class="calc-result" id="troubleshootResult" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Chapter: Case Study -->
                <div class="chapter" id="chapter-casestudy">
                    <h1 class="chapter-title">사례 연구</h1>
                    <p class="chapter-subtitle">성공적인 AAV 제품 개발 사례와 교훈</p>
                    
                    <div class="section-title">실제 AAV 치료제 개발 사례</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">📊 제품 비교 분석 도구</div>
                        <div class="calculator">
                            <label>분석할 제품:</label>
                            <select class="calc-input" id="productSelect">
                                <option value="zolgensma">Zolgensma (SMA)</option>
                                <option value="luxturna">Luxturna (LCA)</option>
                                <option value="glybera">Glybera (LPLD)</option>
                                <option value="hemgenix">Hemgenix (혈우병B)</option>
                                <option value="roctavian">Roctavian (혈우병A)</option>
                            </select>
                            
                            <label>비교 항목:</label>
                            <select class="calc-input" id="analysisType">
                                <option value="technical">기술적 특성</option>
                                <option value="clinical">임상 결과</option>
                                <option value="manufacturing">제조 전략</option>
                                <option value="regulatory">규제 경로</option>
                                <option value="commercial">상업적 성과</option>
                            </select>
                            
                            <button class="btn btn-primary" onclick="analyzeProduct()">제품 분석</button>
                            
                            <div class="calc-result" id="productAnalysisResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>제품명</th>
                                    <th>개발사</th>
                                    <th>적응증</th>
                                    <th>혈청형</th>
                                    <th>승인 연도</th>
                                    <th>가격</th>
                                    <th>현황</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Zolgensma</td>
                                    <td>Novartis</td>
                                    <td>척수성 근위축증</td>
                                    <td>AAV9</td>
                                    <td>2019</td>
                                    <td>$2.1M</td>
                                    <td>판매 중</td>
                                </tr>
                                <tr>
                                    <td>Luxturna</td>
                                    <td>Spark Therapeutics</td>
                                    <td>레베르 선천성 흑암</td>
                                    <td>AAV2</td>
                                    <td>2017</td>
                                    <td>$425K</td>
                                    <td>판매 중</td>
                                </tr>
                                <tr>
                                    <td>Glybera</td>
                                    <td>uniQure</td>
                                    <td>지단백지질분해효소 결핍</td>
                                    <td>AAV1</td>
                                    <td>2012</td>
                                    <td>$1.2M</td>
                                    <td>시장 철수</td>
                                </tr>
                                <tr>
                                    <td>Hemgenix</td>
                                    <td>CSL Behring</td>
                                    <td>혈우병B</td>
                                    <td>AAV5</td>
                                    <td>2022</td>
                                    <td>$3.5M</td>
                                    <td>판매 중</td>
                                </tr>
                                <tr>
                                    <td>Roctavian</td>
                                    <td>BioMarin</td>
                                    <td>혈우병A</td>
                                    <td>AAV5</td>
                                    <td>2022 (EU)</td>
                                    <td>$2.9M</td>
                                    <td>제한적 승인</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">성공 요인 분석</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🎯 성공 요인 가중치 분석</div>
                        <div class="calculator">
                            <label>기술적 우수성 (%):</label>
                            <input type="range" class="calc-input" id="techWeight" min="0" max="100" value="25" oninput="updateWeights()">
                            <span id="techValue">25%</span>
                            
                            <label>임상 효과 (%):</label>
                            <input type="range" class="calc-input" id="clinicalWeight" min="0" max="100" value="30" oninput="updateWeights()">
                            <span id="clinicalValue">30%</span>
                            
                            <label>제조 효율성 (%):</label>
                            <input type="range" class="calc-input" id="manufWeight" min="0" max="100" value="20" oninput="updateWeights()">
                            <span id="manufValue">20%</span>
                            
                            <label>시장 접근성 (%):</label>
                            <input type="range" class="calc-input" id="marketWeight" min="0" max="100" value="25" oninput="updateWeights()">
                            <span id="marketValue">25%</span>
                            
                            <div style="margin-top: 1rem;">
                                <strong>총합: <span id="totalWeight">100%</span></strong>
                            </div>
                            
                            <button class="btn btn-primary" onclick="calculateSuccess()">성공 점수 계산</button>
                            
                            <div class="calc-result" id="successResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="section-title">실패 사례에서 배우는 교훈</div>
                    
                    <div class="warning-box">
                        <strong>⚠️ Glybera 사례 분석:</strong><br>
                        • 문제점: 극도로 높은 가격 ($1.2M), 제한적 환자군<br>
                        • 제조 이슈: 복잡한 생산 공정, 높은 제조 비용<br>
                        • 상업적 실패: 5년간 단 1명 치료 후 시장 철수<br>
                        • 교훈: 기술적 성공만으로는 부족, 경제성과 접근성 필수
                    </div>

                    <div class="success-box">
                        <strong>✅ Zolgensma 성공 요인:</strong><br>
                        • 명확한 의학적 필요성 (생명을 위협하는 희귀질환)<br>
                        • 강력한 임상 효과 (운동 능력 개선, 생존율 향상)<br>
                        • 효율적 제조 공정 (Novartis 대규모 생산 능력)<br>
                        • 전략적 가격 정책 (분할 지불, 성과 기반 계약)
                    </div>
                </div>

                <!-- Chapter: Regulatory Guide -->
                <div class="chapter" id="chapter-regulatory">
                    <h1 class="chapter-title">규제 가이드</h1>
                    <p class="chapter-subtitle">전 세계 규제 기관의 AAV 치료제 승인 요구사항</p>
                    
                    <div class="section-title">주요 규제 기관별 요구사항</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🌍 규제 경로 선택 도구</div>
                        <div class="calculator">
                            <label>개발 단계:</label>
                            <select class="calc-input" id="devStage">
                                <option value="preclinical">전임상</option>
                                <option value="phase1">Phase I</option>
                                <option value="phase2">Phase II</option>
                                <option value="phase3">Phase III</option>
                                <option value="approval">승인 신청</option>
                            </select>
                            
                            <label>목표 시장:</label>
                            <select class="calc-input" id="targetMarket">
                                <option value="us">미국 (FDA)</option>
                                <option value="eu">유럽 (EMA)</option>
                                <option value="japan">일본 (PMDA)</option>
                                <option value="global">글로벌</option>
                            </select>
                            
                            <label>적응증 특성:</label>
                            <select class="calc-input" id="indicationType">
                                <option value="rare">희귀질환</option>
                                <option value="common">일반질환</option>
                                <option value="pediatric">소아질환</option>
                                <option value="oncology">암</option>
                            </select>
                            
                            <button class="btn btn-primary" onclick="getRegulatory()">규제 경로 제시</button>
                            
                            <div class="calc-result" id="regulatoryResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>규제기관</th>
                                    <th>특별 프로그램</th>
                                    <th>장점</th>
                                    <th>요구사항</th>
                                    <th>심사 기간</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FDA</td>
                                    <td>Breakthrough Therapy</td>
                                    <td>우선심사, 집중 지원</td>
                                    <td>예비 임상 효과 입증</td>
                                    <td>6개월</td>
                                </tr>
                                <tr>
                                    <td>FDA</td>
                                    <td>Orphan Drug</td>
                                    <td>시장독점권 7년</td>
                                    <td>희귀질환 (<20만명)</td>
                                    <td>표준</td>
                                </tr>
                                <tr>
                                    <td>EMA</td>
                                    <td>PRIME</td>
                                    <td>조기 과학적 조언</td>
                                    <td>의학적 필요성 입증</td>
                                    <td>150일</td>
                                </tr>
                                <tr>
                                    <td>EMA</td>
                                    <td>ATMP</td>
                                    <td>전문 심사위원회</td>
                                    <td>품질, 안전성, 효능</td>
                                    <td>210일</td>
                                </tr>
                                <tr>
                                    <td>PMDA</td>
                                    <td>Sakigake</td>
                                    <td>신속심사, 우선권</td>
                                    <td>혁신성, 일본 우선</td>
                                    <td>6개월</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">CMC 제출 요구사항</div>
                    
                    <div class="checklist">
                        <h4>FDA IND 제출 체크리스트</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc1">
                            <label for="cmc1">벡터 설계 및 구성 요소 기술</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc2">
                            <label for="cmc2">제조 공정 상세 기술서</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc3">
                            <label for="cmc3">시설 및 장비 정보</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc4">
                            <label for="cmc4">품질 관리 시험법</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc5">
                            <label for="cmc5">안정성 데이터</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc6">
                            <label for="cmc6">환경 안전성 평가</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc7">
                            <label for="cmc7">바이러스 안전성 시험</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc8">
                            <label for="cmc8">원료의약품 정보</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc9">
                            <label for="cmc9">완제의약품 정보</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="cmc10">
                            <label for="cmc10">라벨링 정보</label>
                        </div>
                    </div>

                    <div class="section-title">규제 과학 동향</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">📈 규제 환경 변화 추적</div>
                        <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <h5>주요 변화 동향 (2023-2025)</h5>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                                <div style="background: #f0f9ff; padding: 1rem; border-radius: 6px; border-left: 4px solid #3b82f6;">
                                    <h6 style="color: #1e40af; margin-bottom: 0.5rem;">실시간 분석 허용</h6>
                                    <p style="font-size: 0.9rem;">PAT 기반 Real-Time Release Testing 확대</p>
                                </div>
                                <div style="background: #f0fdf4; padding: 1rem; border-radius: 6px; border-left: 4px solid #10b981;">
                                    <h6 style="color: #059669; margin-bottom: 0.5rem;">연속공정 가이드라인</h6>
                                    <p style="font-size: 0.9rem;">ICH Q13 연속제조 가이드라인 제정</p>
                                </div>
                                <div style="background: #fffbeb; padding: 1rem; border-radius: 6px; border-left: 4px solid #f59e0b;">
                                    <h6 style="color: #d97706; margin-bottom: 0.5rem;">AI/ML 활용 가속화</h6>
                                    <p style="font-size: 0.9rem;">머신러닝 기반 공정 최적화 허용</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <strong>💡 규제 전략 팁:</strong><br>
                        • 조기 규제 기관 상담 활용 (Pre-IND meeting)<br>
                        • 여러 규제 기관 동시 상담 고려<br>
                        • 특별 지정 프로그램 적극 활용<br>
                        • 국제 조화 가이드라인 준수<br>
                        • 지속적인 규제 동향 모니터링
                    </div>
                </div>

                <!-- Chapter: Appendix -->
                <div class="chapter" id="chapter-appendix">
                    <h1 class="chapter-title">부록</h1>
                    <p class="chapter-subtitle">추가 참고 자료 및 실무 도구</p>
                    
                    <div class="section-title">📖 용어집</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🔍 용어 검색 도구</div>
                        <div class="calculator">
                            <label>검색어:</label>
                            <input type="text" class="calc-input" id="termSearch" placeholder="용어를 입력하세요" oninput="searchTerms()">
                            
                            <div id="termResults" style="max-height: 300px; overflow-y: auto; margin-top: 1rem; display: none;">
                                <!-- Search results will appear here -->
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="glossaryTable">
                            <thead>
                                <tr>
                                    <th>용어</th>
                                    <th>영문</th>
                                    <th>정의</th>
                                    <th>관련 분야</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>아데노부속바이러스</td>
                                    <td>Adeno-Associated Virus</td>
                                    <td>비병원성 DNA 바이러스, 유전자 치료 벡터로 활용</td>
                                    <td>기본 개념</td>
                                </tr>
                                <tr>
                                    <td>혈청형</td>
                                    <td>Serotype</td>
                                    <td>캡시드 단백질 구조에 따른 AAV 분류</td>
                                    <td>벡터 설계</td>
                                </tr>
                                <tr>
                                    <td>전염감도</td>
                                    <td>Transfection</td>
                                    <td>세포에 외부 DNA를 도입하는 과정</td>
                                    <td>상류공정</td>
                                </tr>
                                <tr>
                                    <td>크로마토그래피</td>
                                    <td>Chromatography</td>
                                    <td>성분 분리를 위한 정제 기술</td>
                                    <td>하류공정</td>
                                </tr>
                                <tr>
                                    <td>빈 캡시드</td>
                                    <td>Empty Capsid</td>
                                    <td>유전자가 포장되지 않은 바이러스 외각</td>
                                    <td>품질관리</td>
                                </tr>
                                <tr>
                                    <td>숙주세포단백질</td>
                                    <td>Host Cell Protein</td>
                                    <td>생산 세포에서 유래된 불순물 단백질</td>
                                    <td>품질관리</td>
                                </tr>
                                <tr>
                                    <td>공정분석기술</td>
                                    <td>Process Analytical Technology</td>
                                    <td>실시간 공정 모니터링 및 제어 기술</td>
                                    <td>자동화</td>
                                </tr>
                                <tr>
                                    <td>연속공정</td>
                                    <td>Continuous Manufacturing</td>
                                    <td>배치 공정 대신 연속적으로 진행하는 제조</td>
                                    <td>미래 기술</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">📊 단위 변환 도구</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">🔄 AAV 농도 단위 변환기</div>
                        <div class="calculator">
                            <label>입력값:</label>
                            <input type="number" class="calc-input" id="inputValue" placeholder="숫자 입력" step="any">
                            
                            <label>입력 단위:</label>
                            <select class="calc-input" id="inputUnit">
                                <option value="gc_ml">GC/mL</option>
                                <option value="vp_ml">VP/mL</option>
                                <option value="iu_ml">IU/mL</option>
                                <option value="log_gc">log GC/mL</option>
                                <option value="particles_ml">particles/mL</option>
                            </select>
                            
                            <label>출력 단위:</label>
                            <select class="calc-input" id="outputUnit">
                                <option value="gc_ml">GC/mL</option>
                                <option value="vp_ml">VP/mL</option>
                                <option value="iu_ml">IU/mL</option>
                                <option value="log_gc">log GC/mL</option>
                                <option value="particles_ml">particles/mL</option>
                            </select>
                            
                            <button class="btn btn-primary" onclick="convertUnits()">단위 변환</button>
                            
                            <div class="calc-result" id="conversionResult" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="section-title">📋 템플릿 라이브러리</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 2rem 0;">
                        <div class="interactive-box" style="margin: 0;">
                            <div class="interactive-title">📝 SOP 템플릿</div>
                            <p style="margin: 1rem 0;">표준작업절차서 작성을 위한 템플릿</p>
                            <button class="btn btn-primary" onclick="downloadTemplate('sop')">다운로드</button>
                        </div>
                        
                        <div class="interactive-box" style="margin: 0;">
                            <div class="interactive-title">🔬 분석 보고서</div>
                            <p style="margin: 1rem 0;">QC 시험 결과 보고서 템플릿</p>
                            <button class="btn btn-primary" onclick="downloadTemplate('qc')">다운로드</button>
                        </div>
                        
                        <div class="interactive-box" style="margin: 0;">
                            <div class="interactive-title">⚠️ 편차 보고서</div>
                            <p style="margin: 1rem 0;">공정 편차 발생 시 보고서 양식</p>
                            <button class="btn btn-primary" onclick="downloadTemplate('deviation')">다운로드</button>
                        </div>
                        
                        <div class="interactive-box" style="margin: 0;">
                            <div class="interactive-title">📊 배치 기록</div>
                            <p style="margin: 1rem 0;">GMP 배치 제조 기록 양식</p>
                            <button class="btn btn-primary" onclick="downloadTemplate('batch')">다운로드</button>
                        </div>
                    </div>

                    <div class="section-title">🔗 유용한 링크</div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>카테고리</th>
                                    <th>리소스</th>
                                    <th>설명</th>
                                    <th>링크</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>규제 (미국)</td>
                                    <td>FDA 세포·유전자치료 가이던스</td>
                                    <td>미국 FDA의 공식 CGT 가이드라인 모음</td>
                                    <td><a href="https://www.fda.gov/vaccines-blood-biologics/biologics-guidances/cellular-gene-therapy-guidances" target="_blank" style="color: var(--primary-color);">FDA CGT Guidances</a></td>
                                </tr>
                                <tr>
                                    <td>규제 (미국)</td>
                                    <td>FDA CMC 가이던스 (IND)</td>
                                    <td>유전자치료 IND를 위한 CMC 정보 가이던스</td>
                                    <td><a href="https://www.fda.gov/regulatory-information/search-fda-guidance-documents/chemistry-manufacturing-and-control-cmc-information-human-gene-therapy-investigational-new-drug" target="_blank" style="color: var(--primary-color);">FDA CMC Guidance</a></td>
                                </tr>
                                <tr>
                                    <td>규제 (유럽)</td>
                                    <td>EMA ATMP 개요</td>
                                    <td>유럽 첨단치료의약품 규제 개요</td>
                                    <td><a href="https://www.ema.europa.eu/en/human-regulatory-overview/advanced-therapy-medicinal-products-overview" target="_blank" style="color: var(--primary-color);">EMA ATMP Overview</a></td>
                                </tr>
                                <tr>
                                    <td>규제 (유럽)</td>
                                    <td>EMA ATMP 가이드라인</td>
                                    <td>ATMP 관련 상세 가이드라인 모음</td>
                                    <td><a href="https://www.ema.europa.eu/en/human-regulatory-overview/advanced-therapy-medicinal-products-overview/guidelines-relevant-advanced-therapy-medicinal-products" target="_blank" style="color: var(--primary-color);">EMA ATMP Guidelines</a></td>
                                </tr>
                                <tr>
                                    <td>학술 기관</td>
                                    <td>ISCT (국제세포유전자치료학회)</td>
                                    <td>세계 최대 CGT 전문 학술단체</td>
                                    <td><a href="https://www.isctglobal.org/home" target="_blank" style="color: var(--primary-color);">ISCT Global</a></td>
                                </tr>
                                <tr>
                                    <td>학술 기관</td>
                                    <td>ASGCT (미국유전자세포치료학회)</td>
                                    <td>미국 최대 유전자치료 학술단체</td>
                                    <td><a href="https://www.asgct.org/" target="_blank" style="color: var(--primary-color);">ASGCT</a></td>
                                </tr>
                                <tr>
                                    <td>학술 저널</td>
                                    <td>Gene Therapy (Nature)</td>
                                    <td>유전자치료 분야 최고 권위 저널</td>
                                    <td><a href="https://www.nature.com/gt/" target="_blank" style="color: var(--primary-color);">Nature Gene Therapy</a></td>
                                </tr>
                                <tr>
                                    <td>학술 저널</td>
                                    <td>Cytotherapy (ISCT 공식저널)</td>
                                    <td>ISCT 공식 저널, 세포치료 전문</td>
                                    <td><a href="https://www.isct-cytotherapy.org/" target="_blank" style="color: var(--primary-color);">Cytotherapy Journal</a></td>
                                </tr>
                                <tr>
                                    <td>학술 저널</td>
                                    <td>Nature Biotechnology</td>
                                    <td>바이오기술 및 제조 기술 최신 연구</td>
                                    <td><a href="https://www.nature.com/nbt/" target="_blank" style="color: var(--primary-color);">Nature Biotechnology</a></td>
                                </tr>
                                <tr>
                                    <td>학술 저널</td>
                                    <td>Molecular Therapy</td>
                                    <td>유전자치료 분야 핵심 저널</td>
                                    <td><a href="https://www.cell.com/molecular-therapy" target="_blank" style="color: var(--primary-color);">Molecular Therapy</a></td>
                                </tr>
                                <tr>
                                    <td>산업 정보</td>
                                    <td>BioPharma Dive</td>
                                    <td>바이오의약품 산업 뉴스 및 분석</td>
                                    <td><a href="https://www.biopharmadive.com/" target="_blank" style="color: var(--primary-color);">BioPharma Dive</a></td>
                                </tr>
                                <tr>
                                    <td>산업 정보</td>
                                    <td>BioWorld</td>
                                    <td>바이오텍 산업 정보 및 데이터</td>
                                    <td><a href="https://www.bioworld.com/" target="_blank" style="color: var(--primary-color);">BioWorld</a></td>
                                </tr>
                                <tr>
                                    <td>교육</td>
                                    <td>FDA Training Center</td>
                                    <td>FDA 공식 교육 프로그램</td>
                                    <td><a href="https://www.fda.gov/training" target="_blank" style="color: var(--primary-color);">FDA Training</a></td>
                                </tr>
                                <tr>
                                    <td>교육</td>
                                    <td>EMA Learning Network</td>
                                    <td>EMA 온라인 교육 플랫폼</td>
                                    <td><a href="https://www.ema.europa.eu/en/about-us/ema-academy" target="_blank" style="color: var(--primary-color);">EMA Academy</a></td>
                                </tr>
                                <tr>
                                    <td>데이터베이스</td>
                                    <td>ClinicalTrials.gov</td>
                                    <td>전 세계 임상시험 데이터베이스</td>
                                    <td><a href="https://clinicaltrials.gov/" target="_blank" style="color: var(--primary-color);">ClinicalTrials.gov</a></td>
                                </tr>
                                <tr>
                                    <td>데이터베이스</td>
                                    <td>Gene Therapy Clinical Trials</td>
                                    <td>유전자치료 임상시험 전문 DB</td>
                                    <td><a href="https://www.abedia.com/wiley/" target="_blank" style="color: var(--primary-color);">GT Clinical Trials</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">📚 추천 도서 및 핵심 논문</div>
                    
                    <div class="checklist">
                        <h4>필독 자료 체크리스트</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="read1">
                            <label for="read1">"Manufacturing of recombinant AAV viral vectors for clinical trials" (PMC, 2016)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read2">
                            <label for="read2">"Scalable Production of AAV Vectors in Orbitally Shaken HEK293 Cells" (Mol Ther, 2019)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read3">
                            <label for="read3">FDA Guidance: CMC Information for Human Gene Therapy INDs (2020)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read4">
                            <label for="read4">"Downstream processing of AAV based gene therapy vectors" (ScienceDirect, 2025)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read5">
                            <label for="read5">"High-efficiency purification of divergent AAV serotypes using AAVX" (PMC, 2023)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read6">
                            <label for="read6">ICH Q11: Development and Manufacture of Drug Substances (ICH, 2012)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read7">
                            <label for="read7">"Platform Chromatography Purification Process for AAV" (Biotechnology Journal, 2025)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read8">
                            <label for="read8">EMA Guideline: Quality, non-clinical and clinical requirements for ATMPs (2025)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read9">
                            <label for="read9">"AAV manufacturing for clinical use: Insights from upstream process" (ScienceDirect, 2021)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="read10">
                            <label for="read10">"Moving from the bench towards large scale AAV purification" (Biotech Bioeng, 2020)</label>
                        </div>
                    </div>

                    <div class="section-title">🔗 업계 표준 도구 및 리소스</div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>도구 유형</th>
                                    <th>이름</th>
                                    <th>제공업체</th>
                                    <th>용도</th>
                                    <th>접근 방법</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>계산 도구</td>
                                    <td>AAV Titer Calculator</td>
                                    <td>Thermo Fisher</td>
                                    <td>qPCR 결과 기반 역가 계산</td>
                                    <td>온라인 무료 도구</td>
                                </tr>
                                <tr>
                                    <td>계산 도구</td>
                                    <td>Chromatography Sizing Tool</td>
                                    <td>Cytiva</td>
                                    <td>컬럼 크기 및 조건 최적화</td>
                                    <td>기술 지원팀 문의</td>
                                </tr>
                                <tr>
                                    <td>분석 소프트웨어</td>
                                    <td>FlowJo</td>
                                    <td>BD Biosciences</td>
                                    <td>Flow cytometry 데이터 분석</td>
                                    <td>라이센스 구매</td>
                                </tr>
                                <tr>
                                    <td>분석 소프트웨어</td>
                                    <td>SEDFIT</td>
                                    <td>NIH</td>
                                    <td>AUC 데이터 분석</td>
                                    <td>무료 다운로드</td>
                                </tr>
                                <tr>
                                    <td>데이터베이스</td>
                                    <td>Vector Database</td>
                                    <td>AddGene</td>
                                    <td>AAV 벡터 서열 정보</td>
                                    <td>온라인 검색</td>
                                </tr>
                                <tr>
                                    <td>설계 도구</td>
                                    <td>SnapGene</td>
                                    <td>Dotmatics</td>
                                    <td>벡터 설계 및 시뮬레이션</td>
                                    <td>소프트웨어 구매</td>
                                </tr>
                                <tr>
                                    <td>통계 도구</td>
                                    <td>Minitab</td>
                                    <td>Minitab Inc.</td>
                                    <td>공정 능력 및 DoE 분석</td>
                                    <td>라이센스 구매</td>
                                </tr>
                                <tr>
                                    <td>규제 도구</td>
                                    <td>eCTD Viewer</td>
                                    <td>ICH</td>
                                    <td>전자 제출 문서 작성</td>
                                    <td>ICH 웹사이트</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">🏢 주요 제조업체 및 서비스 제공업체</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
                        <div class="interactive-box" style="margin: 0;">
                            <div class="interactive-title">🏭 CDMO 서비스</div>
                            <ul style="margin: 1rem 0; list-style: none; padding: 0;">
                                <li>• <strong>Novartis (AveXis)</strong> - 대규모 AAV 생산</li>
                                <li>• <strong>Catalent</strong> - 통합 AAV 제조</li>
                                <li>• <strong>WuXi Advanced Therapies</strong> - 글로벌 CDMO</li>
                                <li>• <strong>Charles River</strong> - 연구부터 상업화까지</li>
                                <li>• <strong>Viralgen</strong> - AAV 전문 CDMO</li>
                            </ul>
                        </div>
                        
                        <div class="interactive-box" style="margin: 0;">
                            <div class="interactive-title">🧪 핵심 소재 공급업체</div>
                            <ul style="margin: 1rem 0; list-style: none; padding: 0;">
                                <li>• <strong>Thermo Fisher (AAVX resin)</strong> - 정제 수지</li>
                                <li>• <strong>Cytiva</strong> - 크로마토그래피 시스템</li>
                                <li>• <strong>Polyplus</strong> - Transfection 시약</li>
                                <li>• <strong>Merck (MilliporeSigma)</strong> - 필터 및 TFF</li>
                                <li>• <strong>Sartorius</strong> - 바이오리액터</li>
                            </ul>
                        </div>
                        
                        <div class="interactive-box" style="margin: 0;">
                            <div class="interactive-title">🔬 분석 장비 제공업체</div>
                            <ul style="margin: 1rem 0; list-style: none; padding: 0;">
                                <li>• <strong>Beckman Coulter</strong> - AUC, 원심분리</li>
                                <li>• <strong>Applied Biosystems</strong> - qPCR 시스템</li>
                                <li>• <strong>Agilent</strong> - HPLC, 분석 장비</li>
                                <li>• <strong>Waters</strong> - 크로마토그래피</li>
                                <li>• <strong>Bio-Rad</strong> - 전기영동, PCR</li>
                            </ul>
                        </div>
                        
                        <div class="interactive-box" style="margin: 0;">
                            <div class="interactive-title">💻 소프트웨어 솔루션</div>
                            <ul style="margin: 1rem 0; list-style: none; padding: 0;">
                                <li>• <strong>Veeva</strong> - 전자 QMS</li>
                                <li>• <strong>MasterControl</strong> - 문서 관리</li>
                                <li>• <strong>Emerson DeltaV</strong> - 공정 제어</li>
                                <li>• <strong>OSIsoft PI</strong> - 데이터 히스토리안</li>
                                <li>• <strong>Wonderware MES</strong> - 제조 실행</li>
                            </ul>
                        </div>
                    </div>

                    <div class="section-title">📧 전문가 네트워크 및 커뮤니티</div>
                    
                    <div class="highlight-box">
                        <strong>💡 업계 네트워킹 팁:</strong><br>
                        • <strong>LinkedIn 그룹</strong>: "Gene Therapy Professionals", "AAV Manufacturing"<br>
                        • <strong>학회 참가</strong>: ISCT, ASGCT 연례 학술대회 필수 참석<br>
                        • <strong>온라인 포럼</strong>: ResearchGate, BioSpace 커뮤니티 활용<br>
                        • <strong>웨비나</strong>: 주요 업체들의 기술 웨비나 정기 참석<br>
                        • <strong>전문 교육</strong>: FDA, EMA 주관 워크샵 및 트레이닝 과정
                    </div>

                    <div class="warning-box">
                        <strong>⚠️ 링크 사용 시 주의사항:</strong><br>
                        • 모든 외부 링크는 2025년 8월 기준으로 확인되었습니다<br>
                        • 일부 리소스는 로그인이나 구독이 필요할 수 있습니다<br>
                        • 규제 가이던스는 정기적으로 업데이트되므로 최신 버전 확인 필요<br>
                        • 상업적 도구 사용 시 라이센스 및 비용 확인 권장<br>
                        • 학술 자료 이용 시 저작권 및 인용 규정 준수 필수
                    </div>

                    <div class="section-title">🔄 교재 업데이트 정보</div>
                    
                    <div class="interactive-box">
                        <div class="interactive-title">📅 버전 이력</div>
                        <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <h6 style="color: var(--primary-color); margin-bottom: 1rem;">Version 1.0 (2025년 8월)</h6>
                            <ul style="margin: 0; padding-left: 1.5rem;">
                                <li><strong>초판 출간</strong> - 전체 13개 챕터 완성</li>
                                <li><strong>외부 링크 검증</strong> - 총 16개 주요 기관 링크 확인</li>
                                <li><strong>계산 도구</strong> - 20+ 인터랙티브 계산기 구현</li>
                                <li><strong>사례 연구</strong> - 5개 주요 AAV 제품 분석 포함</li>
                                <li><strong>실무 템플릿</strong> - SOP, 보고서 양식 4종 제공</li>
                            </ul>
                            
                            <h6 style="color: var(--primary-color); margin: 1.5rem 0 1rem 0;">예정된 업데이트</h6>
                            <ul style="margin: 0; padding-left: 1.5rem;">
                                <li><strong>Version 1.1 (2025년 12월)</strong> - 최신 규제 동향 반영</li>
                                <li><strong>Version 1.2 (2026년 상반기)</strong> - 새로운 기술 동향 추가</li>
                                <li><strong>Version 2.0 (2026년 하반기)</strong> - 연속공정 기술 대폭 확장</li>
                            </ul>
                        </div>
                    </div>

                    <div class="success-box">
                        <strong>✅ 링크 검증 완료 사항:</strong><br>
                        • <strong>FDA 공식 사이트</strong>: 4개 주요 가이던스 링크 검증 (2025.08.14)<br>
                        • <strong>EMA 공식 사이트</strong>: 4개 ATMP 관련 링크 검증 (2025.08.14)<br>
                        • <strong>학술 기관</strong>: ISCT, ASGCT 공식 홈페이지 확인<br>
                        • <strong>학술 저널</strong>: Nature, Cell Press 계열 저널 링크 검증<br>
                        • <strong>산업 정보</strong>: 주요 업계 뉴스 사이트 4개 확인<br>
                        • <strong>교육 리소스</strong>: FDA/EMA 공식 교육 사이트 포함
                    </div>

                    <div class="section-title">📞 문의 및 피드백</div>
                    
                    <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px; padding: 2rem; margin: 2rem 0;">
                        <h5 style="color: var(--primary-color); margin-bottom: 1rem;">교재 개선을 위한 여러분의 의견을 기다립니다</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div>
                                <h6>🔗 링크 오류 신고</h6>
                                <p style="font-size: 0.9rem; margin: 0.5rem 0;">작동하지 않는 링크나 잘못된 정보를 발견하시면 즉시 신고해 주세요.</p>
                            </div>
                            <div>
                                <h6>📝 내용 개선 제안</h6>
                                <p style="font-size: 0.9rem; margin: 0.5rem 0;">추가되었으면 하는 내용이나 수정이 필요한 부분을 알려주세요.</p>
                            </div>
                            <div>
                                <h6>🆕 최신 정보 제보</h6>
                                <p style="font-size: 0.9rem; margin: 0.5rem 0;">새로운 규제 동향이나 기술 발전 사항을 공유해 주세요.</p>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button class="btn btn-primary" onclick="provideFeedback()">피드백 제공하기</button>
                        </div>
                    </div>

                    <div class="section-title">📜 저작권 및 면책 조항</div>
                    
                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 2rem 0; font-size: 0.9rem; line-height: 1.5;">
                        <h6 style="margin-bottom: 1rem; color: var(--text-color);">면책 조항</h6>
                        <p style="margin-bottom: 1rem;">본 교재는 교육 목적으로 제작되었으며, 실제 제조 공정이나 규제 준수에 대한 법적 조언을 제공하지 않습니다. 모든 외부 링크는 제3자가 운영하는 사이트로, 해당 사이트의 내용이나 가용성에 대해 책임지지 않습니다.</p>
                        
                        <p style="margin-bottom: 1rem;"><strong>규제 정보:</strong> FDA, EMA 등 규제 기관의 가이던스는 지속적으로 업데이트되므로, 실제 적용 시 최신 버전을 확인하시기 바랍니다.</p>
                        
                        <p style="margin-bottom: 1rem;"><strong>상업적 정보:</strong> 언급된 제품, 서비스, 회사명은 정보 제공 목적이며, 특정 제품이나 서비스를 추천하는 것은 아닙니다.</p>
                        
                        <p style="margin: 0;"><strong>최종 업데이트:</strong> 2025년 8월 14일 | <strong>다음 검토 예정일:</strong> 2025년 12월</p>
                    </div>
                </div>

                <!-- Chapter Navigation -->
                <div class="chapter-nav">
                    <button class="nav-btn" id="prevBtn" onclick="previousChapter()">← 이전 장</button>
                    <span id="chapterInfo">1 / 10</span>
                    <button class="nav-btn" id="nextBtn" onclick="nextChapter()">다음 장 →</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // State management
        let currentChapter = 0;
        let chapters = ['intro', 'design', 'overview', 'upstream', 'downstream', 'quality', 'gmp', 'automation', 'future', 'casestudy', 'regulatory', 'tools', 'appendix'];
        let readChapters = new Set(['intro']);
        let bookmarks = new Set();
        let notes = {};
        let isDarkMode = false;

        // Glossary data
        const glossaryData = [
            {term: "아데노부속바이러스", english: "Adeno-Associated Virus", definition: "비병원성 DNA 바이러스, 유전자 치료 벡터로 활용", category: "기본 개념"},
            {term: "혈청형", english: "Serotype", definition: "캡시드 단백질 구조에 따른 AAV 분류", category: "벡터 설계"},
            {term: "전염감도", english: "Transfection", definition: "세포에 외부 DNA를 도입하는 과정", category: "상류공정"},
            {term: "크로마토그래피", english: "Chromatography", definition: "성분 분리를 위한 정제 기술", category: "하류공정"},
            {term: "빈 캡시드", english: "Empty Capsid", definition: "유전자가 포장되지 않은 바이러스 외각", category: "품질관리"},
            {term: "숙주세포단백질", english: "Host Cell Protein", definition: "생산 세포에서 유래된 불순물 단백질", category: "품질관리"},
            {term: "공정분석기술", english: "Process Analytical Technology", definition: "실시간 공정 모니터링 및 제어 기술", category: "자동화"},
            {term: "연속공정", english: "Continuous Manufacturing", definition: "배치 공정 대신 연속적으로 진행하는 제조", category: "미래 기술"}
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            updateChapterInfo();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const chapter = this.dataset.chapter;
                    showChapter(chapter);
                });
            });

            // Sidebar toggle
            document.getElementById('toggleSidebar').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('mainContent');
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            });

            // Theme toggle
            document.getElementById('toggleTheme').addEventListener('click', function() {
                isDarkMode = !isDarkMode;
                document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
                this.textContent = isDarkMode ? '☀️ 라이트모드' : '🌙 다크모드';
            });

            // Search
            document.getElementById('searchInput').addEventListener('input', function() {
                const query = this.value.toLowerCase();
                // Simple search implementation
                if (query.length > 2) {
                    searchContent(query);
                }
            });

            // Bookmark
            document.getElementById('bookmarkBtn').addEventListener('click', function() {
                const currentChapterName = chapters[currentChapter];
                if (bookmarks.has(currentChapterName)) {
                    bookmarks.delete(currentChapterName);
                    this.textContent = '🔖 북마크';
                } else {
                    bookmarks.add(currentChapterName);
                    this.textContent = '📌 북마크됨';
                }
            });

            // Notes
            document.getElementById('notesBtn').addEventListener('click', function() {
                const note = prompt('이 페이지에 대한 노트를 입력하세요:');
                if (note) {
                    notes[chapters[currentChapter]] = note;
                    alert('노트가 저장되었습니다.');
                }
            });

            // Quiz
            document.getElementById('quizBtn').addEventListener('click', function() {
                showQuiz();
            });

            // Summary
            document.getElementById('summaryBtn').addEventListener('click', function() {
                showSummary();
            });

            // Checklist
            document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const item = this.closest('.checklist-item');
                    if (this.checked) {
                        item.classList.add('completed');
                    } else {
                        item.classList.remove('completed');
                    }
                    updateProgress();
                });
            });
        }

        function showQuiz() {
            const quizQuestions = getQuizForCurrentChapter();
            
            let quizHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; display: flex; align-items: center; justify-content: center;" id="quizModal">
                    <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">📋 ${getChapterTitle()} 퀴즈</h3>
                        <div id="quizContent">
            `;
            
            quizQuestions.forEach((q, index) => {
                quizHTML += `
                    <div style="margin-bottom: 2rem; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px;">
                        <p style="font-weight: 600; margin-bottom: 1rem;">${index + 1}. ${q.question}</p>
                        ${q.options.map((option, i) => `
                            <label style="display: block; margin: 0.5rem 0; cursor: pointer;">
                                <input type="radio" name="q${index}" value="${i}" style="margin-right: 0.5rem;">
                                ${option}
                            </label>
                        `).join('')}
                    </div>
                `;
            });
            
            quizHTML += `
                        </div>
                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="submitQuiz()">답안 제출</button>
                            <button class="btn" onclick="closeQuiz()" style="margin-left: 1rem;">닫기</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', quizHTML);
        }

        function getQuizForCurrentChapter() {
            const chapterName = chapters[currentChapter];
            
            const quizData = {
                intro: [
                    {
                        question: "AAV 벡터의 주요 장점이 아닌 것은?",
                        options: ["비병원성", "높은 면역원성", "장기간 발현", "비분열 세포 감염"],
                        correct: 1
                    },
                    {
                        question: "현재 AAV 제조의 가장 큰 도전과제는?",
                        options: ["안전성", "효능", "생산 비용", "보관 조건"],
                        correct: 2
                    }
                ],
                design: [
                    {
                        question: "AAV 벡터 카세트의 최대 크기는?",
                        options: ["3.5 kb", "4.7 kb", "5.5 kb", "6.0 kb"],
                        correct: 1
                    },
                    {
                        question: "BBB 투과성이 가장 우수한 혈청형은?",
                        options: ["AAV2", "AAV8", "AAV9", "AAVrh10"],
                        correct: 2
                    }
                ],
                upstream: [
                    {
                        question: "Triple transfection에서 사용되지 않는 플라스미드는?",
                        options: ["Vector plasmid", "Rep/Cap plasmid", "Helper plasmid", "Control plasmid"],
                        correct: 3
                    },
                    {
                        question: "Transfection 후 권장되는 온도 shift는?",
                        options: ["37°C → 30°C", "37°C → 32-34°C", "37°C → 25°C", "온도 변경 없음"],
                        correct: 1
                    }
                ],
                downstream: [
                    {
                        question: "현재 업계 표준 AAV affinity resin은?",
                        options: ["Heparin", "AAVX", "Protein A", "Blue Sepharose"],
                        correct: 1
                    },
                    {
                        question: "Empty capsid와 Full capsid 분리에 가장 효과적인 방법은?",
                        options: ["SEC", "Affinity", "AEX", "HIC"],
                        correct: 2
                    }
                ],
                quality: [
                    {
                        question: "AAV 역가 측정의 표준 방법은?",
                        options: ["ELISA", "qPCR", "Western blot", "Flow cytometry"],
                        correct: 1
                    },
                    {
                        question: "Full capsid 비율의 목표값은?",
                        options: [">50%", ">70%", ">85%", ">95%"],
                        correct: 2
                    }
                ]
            };
            
            return quizData[chapterName] || [
                {
                    question: "이 챕터의 핵심 내용을 잘 이해하셨나요?",
                    options: ["매우 잘 이해함", "어느 정도 이해함", "조금 이해함", "다시 학습 필요"],
                    correct: 0
                }
            ];
        }

        function submitQuiz() {
            const questions = getQuizForCurrentChapter();
            let score = 0;
            let total = questions.length;
            
            questions.forEach((q, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                if (selected && parseInt(selected.value) === q.correct) {
                    score++;
                }
            });
            
            const percentage = Math.round((score / total) * 100);
            let message = `점수: ${score}/${total} (${percentage}%)\n\n`;
            
            if (percentage >= 80) {
                message += "🎉 우수! 내용을 잘 이해하고 계십니다.";
            } else if (percentage >= 60) {
                message += "👍 양호! 몇 가지 개념을 다시 확인해보세요.";
            } else {
                message += "📚 해당 챕터를 다시 학습하시기 바랍니다.";
            }
            
            alert(message);
            closeQuiz();
        }

        function closeQuiz() {
            const modal = document.getElementById('quizModal');
            if (modal) {
                modal.remove();
            }
        }

        function showSummary() {
            const summary = getChapterSummary();
            
            let summaryHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; display: flex; align-items: center; justify-content: center;" id="summaryModal">
                    <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">📄 ${getChapterTitle()} 요약</h3>
                        <div style="line-height: 1.6;">
                            ${summary}
                        </div>
                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="closeSummary()">닫기</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', summaryHTML);
        }

        function getChapterSummary() {
            const chapterName = chapters[currentChapter];
            
            const summaries = {
                intro: `
                    <h4>핵심 요약</h4>
                    <ul>
                        <li><strong>AAV 벡터</strong>: 비병원성, 낮은 면역원성으로 유전자 치료의 최적 전달체</li>
                        <li><strong>시장 현황</strong>: 연평균 30% 이상 성장, 70개 이상의 임상시험 진행</li>
                        <li><strong>주요 도전과제</strong>: 스케일업, 비용 절감, Empty/Full 비율 개선</li>
                        <li><strong>미래 전망</strong>: 연속공정, AI 활용으로 제조비 90% 절감 목표</li>
                    </ul>
                `,
                design: `
                    <h4>핵심 요약</h4>
                    <ul>
                        <li><strong>혈청형 선택</strong>: 표적 조직에 따라 AAV1-rh10 중 최적 선택</li>
                        <li><strong>카세트 설계</strong>: 4.7kb 이하, ITR 간섭 최소화, codon 최적화</li>
                        <li><strong>BBB 투과</strong>: AAV9이 가장 우수, CNS 질환에 필수</li>
                        <li><strong>면역 회피</strong>: 차세대 캡시드로 재투여 성공률 향상</li>
                    </ul>
                `,
                upstream: `
                    <h4>핵심 요약</h4>
                    <ul>
                        <li><strong>세포 배양</strong>: HEK293 suspension, 200L 이상 대규모 가능</li>
                        <li><strong>Triple transfection</strong>: Vector:Rep/Cap:Helper = 1:1:2 비율</li>
                        <li><strong>온도 shift</strong>: 37°C → 32-34°C로 AAV 안정성 향상</li>
                        <li><strong>대안 시스템</strong>: Baculovirus-Sf9으로 더 높은 수율 달성</li>
                    </ul>
                `,
                downstream: `
                    <h4>핵심 요약</h4>
                    <ul>
                        <li><strong>정제 순서</strong>: Clarification → Affinity → IEX → SEC</li>
                        <li><strong>AAVX resin</strong>: 업계 표준, 광범위 혈청형 적용 가능</li>
                        <li><strong>Empty/Full 분리</strong>: AEX로 분리, AUC로 정량</li>
                        <li><strong>목표 수율</strong>: 전체 공정 65-80% 달성</li>
                    </ul>
                `,
                quality: `
                    <h4>핵심 요약</h4>
                    <ul>
                        <li><strong>필수 시험</strong>: 역가(qPCR), 순도, 안전성, 동일성</li>
                        <li><strong>규격 기준</strong>: HCP <100ng/dose, DNA <10ng/dose</li>
                        <li><strong>Full capsid</strong>: >70% 필수, >85% 목표</li>
                        <li><strong>안정성</strong>: -80°C 24개월, -20°C 12개월</li>
                    </ul>
                `
            };
            
            return summaries[chapterName] || `
                <p>이 챕터의 핵심 내용을 정리하여 학습 효과를 높이세요.</p>
                <p>중요한 개념들을 다시 한번 확인하고, 실무에 적용할 수 있는 지식을 정리해보시기 바랍니다.</p>
            `;
        }

        function getChapterTitle() {
            const titles = {
                intro: "서론",
                design: "벡터 설계", 
                overview: "공정 개요",
                upstream: "상류공정",
                downstream: "하류공정",
                quality: "품질관리",
                gmp: "GMP & 스케일업",
                automation: "자동화 & PAT",
                future: "미래 전망",
                casestudy: "사례 연구",
                regulatory: "규제 가이드",
                tools: "실무 도구",
                appendix: "부록"
            };
            
            return titles[chapters[currentChapter]] || "현재 챕터";
        }

        function closeSummary() {
            const modal = document.getElementById('summaryModal');
            if (modal) {
                modal.remove();
            }
        }

        function showChapter(chapterName) {
            // Hide all chapters
            document.querySelectorAll('.chapter').forEach(chapter => {
                chapter.classList.remove('active');
            });

            // Show selected chapter
            document.getElementById(`chapter-${chapterName}`).classList.add('active');

            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-chapter="${chapterName}"]`).classList.add('active');

            // Update current chapter index
            currentChapter = chapters.indexOf(chapterName);
            readChapters.add(chapterName);

            // Update bookmark button
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            if (bookmarks.has(chapterName)) {
                bookmarkBtn.textContent = '📌 북마크됨';
            } else {
                bookmarkBtn.textContent = '🔖 북마크';
            }

            updateProgress();
            updateChapterInfo();
        }

        function updateProgress() {
            const totalChapters = chapters.length;
            const completedChapters = readChapters.size;
            const progressPercent = Math.round((completedChapters / totalChapters) * 100);
            
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = `${progressPercent}% 완료`;
        }

        function updateChapterInfo() {
            document.getElementById('chapterInfo').textContent = `${currentChapter + 1} / ${chapters.length}`;
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentChapter === 0;
            nextBtn.disabled = currentChapter === chapters.length - 1;
        }

        function previousChapter() {
            if (currentChapter > 0) {
                showChapter(chapters[currentChapter - 1]);
            }
        }

        function nextChapter() {
            if (currentChapter < chapters.length - 1) {
                showChapter(chapters[currentChapter + 1]);
            }
        }

        function searchContent(query) {
            // Simple search highlighting
            document.querySelectorAll('.content-text, .section-title, .subsection-title').forEach(element => {
                const text = element.textContent.toLowerCase();
                if (text.includes(query)) {
                    element.style.backgroundColor = 'yellow';
                    element.style.padding = '2px';
                } else {
                    element.style.backgroundColor = '';
                    element.style.padding = '';
                }
            });
        }

        // Calculator functions
        function calculateMarket() {
            const patients = parseFloat(document.getElementById('patientCount').value);
            const dose = parseFloat(document.getElementById('dosePerPatient').value);
            const cost = parseFloat(document.getElementById('costPerDose').value);
            
            const totalMarket = patients * cost;
            const totalDoses = patients * dose;
            
            const result = `
                <strong>시장 분석 결과:</strong><br>
                • 총 시장 규모: ${(totalMarket / 1000000).toFixed(1)}M<br>
                • 필요 총 용량: ${totalDoses.toExponential(2)} GC<br>
                • 환자당 치료비: ${cost.toLocaleString()}<br>
                • 제조 복잡도: ${totalDoses > 1e18 ? '매우 높음' : totalDoses > 1e16 ? '높음' : '중간'}
            `;
            
            document.getElementById('marketResult').innerHTML = result;
            document.getElementById('marketResult').style.display = 'block';
        }

        function recommendSerotype() {
            const tissue = document.getElementById('targetTissue').value;
            const route = document.getElementById('deliveryRoute').value;
            
            let recommendation = '';
            
            switch(tissue) {
                case 'brain':
                    recommendation = route === 'iv' ? 'AAV9 (BBB 투과성 우수)' : 'AAV1, AAV9 (직접 주사)';
                    break;
                case 'liver':
                    recommendation = 'AAV8 (간 특이성 최고), AAV2 (범용)';
                    break;
                case 'muscle':
                    recommendation = 'AAV1 (근육 특이성), AAV6 (심근)';
                    break;
                case 'eye':
                    recommendation = 'AAV2 (망막), AAV8 (안구내 주사)';
                    break;
                case 'lung':
                    recommendation = 'AAVrh10, AAV5 (기도상피)';
                    break;
                case 'heart':
                    recommendation = 'AAV6, AAV9 (심근세포)';
                    break;
            }
            
            const result = `
                <strong>추천 혈청형:</strong><br>
                ${recommendation}<br><br>
                <strong>고려사항:</strong><br>
                • 면역원성 및 중화항체 존재 여부 확인<br>
                • 종간 차이 (동물모델 vs 인간)<br>
                • 용량 최적화 필요
            `;
            
            document.getElementById('serotypeResult').innerHTML = result;
            document.getElementById('serotypeResult').style.display = 'block';
        }

        function calculateCassetteSize() {
            const itr = 290;
            const promoter = parseFloat(document.getElementById('promoterLength').value) || 0;
            const gene = parseFloat(document.getElementById('geneLength').value) || 0;
            const polyA = parseFloat(document.getElementById('polyALength').value) || 0;
            
            const total = itr + promoter + gene + polyA;
            const limit = 4700;
            const remaining = limit - total;
            
            let status = '';
            let color = '';
            
            if (total <= limit) {
                status = '✅ 패키징 가능';
                color = 'var(--success-color)';
            } else {
                status = '❌ 크기 초과 - 최적화 필요';
                color = 'var(--danger-color)';
            }
            
            const result = `
                <div style="color: ${color};">
                    <strong>총 카세트 크기: ${total} bp</strong><br>
                    한계까지 여유: ${remaining} bp<br>
                    상태: ${status}
                </div>
            `;
            
            document.getElementById('cassetteResult').innerHTML = result;
            document.getElementById('cassetteResult').style.display = 'block';
        }

        function calculateScaleup() {
            const current = parseFloat(document.getElementById('currentScale').value);
            const target = parseFloat(document.getElementById('targetScale').value);
            const yield_val = parseFloat(document.getElementById('currentYield').value);
            
            const scaleFactor = target / current;
            const expectedYield = yield_val * 0.8; // Typically 20% reduction in yield
            const totalProduction = target * expectedYield;
            
            const challenges = scaleFactor > 10 ? '높음 - 상당한 최적화 필요' : 
                              scaleFactor > 5 ? '중간 - 공정 조정 필요' : '낮음';
            
            const result = `
                <strong>스케일업 분석:</strong><br>
                • 스케일 증가: ${scaleFactor.toFixed(1)}x<br>
                • 예상 수율: ${expectedYield.toExponential(2)} GC/L<br>
                • 총 생산량: ${totalProduction.toExponential(2)} GC<br>
                • 기술적 난이도: ${challenges}<br>
                • 권장 단계: ${scaleFactor > 10 ? '단계적 스케일업' : '직접 스케일업 가능'}
            `;
            
            document.getElementById('scaleupResult').innerHTML = result;
            document.getElementById('scaleupResult').style.display = 'block';
        }

        function calculateCulture() {
            const volume = parseFloat(document.getElementById('cultureVolume').value);
            const initialDensity = parseFloat(document.getElementById('initialDensity').value);
            const targetDensity = parseFloat(document.getElementById('targetDensity').value);
            const doublingTime = parseFloat(document.getElementById('doublingTime').value);
            
            const doublingRequired = Math.log2(targetDensity / initialDensity);
            const timeRequired = doublingRequired * doublingTime;
            const totalCells = volume * 1000 * targetDensity * 1e6; // Total cells at transfection
            
            const result = `
                <strong>배양 계획:</strong><br>
                • 필요 배가 횟수: ${doublingRequired.toFixed(1)}회<br>
                • 소요 시간: ${timeRequired.toFixed(1)}시간 (${(timeRequired/24).toFixed(1)}일)<br>
                • Transfection 시점 총 세포수: ${totalCells.toExponential(2)}개<br>
                • 권장 feeding 시작: ${timeRequired > 48 ? 'Day 2부터' : 'Day 1부터'}<br>
                • 예상 harvest: Day ${Math.ceil(timeRequired/24) + 4}
            `;
            
            document.getElementById('cultureResult').innerHTML = result;
            document.getElementById('cultureResult').style.display = 'block';
        }

        function calculateTransfection() {
            const volume = parseFloat(document.getElementById('transfectionVolume').value);
            const cellDensity = parseFloat(document.getElementById('cellDensity').value);
            const dnaConc = parseFloat(document.getElementById('dnaConcentration').value);
            
            const totalCells = volume * cellDensity * 1e6;
            const totalDNA = volume * dnaConc / 1000; // Convert to mg
            const vectorDNA = totalDNA * 0.25; // 25% of total DNA
            const repCapDNA = totalDNA * 0.25; // 25% of total DNA
            const helperDNA = totalDNA * 0.5; // 50% of total DNA
            const peiAmount = totalDNA * 3; // 3:1 PEI:DNA ratio
            
            const result = `
                <strong>Transfection 레시피 (${volume/1000}L):</strong><br>
                • 총 세포수: ${totalCells.toExponential(2)}개<br>
                • Vector plasmid: ${vectorDNA.toFixed(1)} mg<br>
                • Rep/Cap plasmid: ${repCapDNA.toFixed(1)} mg<br>
                • Helper plasmid: ${helperDNA.toFixed(1)} mg<br>
                • PEI 시약: ${peiAmount.toFixed(1)} mg<br>
                • 복합체 형성 시간: 15-20분<br>
                • 첨가 후 온도: 32-34°C로 shift
            `;
            
            document.getElementById('transfectionResult').innerHTML = result;
            document.getElementById('transfectionResult').style.display = 'block';
        }

        function calculateLysis() {
            const volume = parseFloat(document.getElementById('harvestVolume').value);
            const density = parseFloat(document.getElementById('harvestDensity').value);
            const method = document.getElementById('lysisMethod').value;
            
            const totalCells = volume * 1000 * density * 1e6;
            let lysisReagent = '';
            let condition = '';
            let time = '';
            
            switch(method) {
                case 'triton':
                    lysisReagent = `Triton X-100: ${(volume * 0.5).toFixed(1)} mL (0.1% 최종농도)`;
                    condition = '4°C, 30분 교반';
                    time = '1-2시간';
                    break;
                case 'freeze':
                    lysisReagent = '동결해동 (3회)';
                    condition = '-80°C → 37°C 반복';
                    time = '6-8시간';
                    break;
                case 'detergent':
                    lysisReagent = '기타 세제 (농도 최적화 필요)';
                    condition = '4°C, 온화한 교반';
                    time = '1-3시간';
                    break;
            }
            
            const benzonase = (totalCells / 1e8 * 25).toFixed(1); // 25 U per 1e8 cells
            
            const result = `
                <strong>용해 조건 (${volume}L):</strong><br>
                • 총 세포수: ${totalCells.toExponential(2)}개<br>
                • ${lysisReagent}<br>
                • Benzonase: ${benzonase} Units<br>
                • 조건: ${condition}<br>
                • 소요시간: ${time}<br>
                • 다음 단계: Depth filtration
            `;
            
            document.getElementById('lysisResult').innerHTML = result;
            document.getElementById('lysisResult').style.display = 'block';
        }

        function calculateColumn() {
            const volume = parseFloat(document.getElementById('columnVolume').value);
            const aavConc = parseFloat(document.getElementById('aavConcentration').value) * 1e12;
            const capacity = parseFloat(document.getElementById('resinCapacity').value) * 1e13;
            const flowRate = parseFloat(document.getElementById('flowRate').value);
            
            const totalAAV = volume * aavConc;
            const requiredResin = totalAAV / capacity * 2; // 2x safety factor
            const columnVolume_L = requiredResin / 1000; // Convert to L
            const diameter = Math.sqrt(columnVolume_L * 4 / (Math.PI * 0.2)); // Assume H/D = 5
            const height = diameter * 5;
            const processTime = volume / (columnVolume_L * flowRate) * 1000;
            
            const result = `
                <strong>컬럼 사이징 결과:</strong><br>
                • 총 AAV 량: ${totalAAV.toExponential(2)} GC<br>
                • 필요 수지량: ${requiredResin.toFixed(1)} mL<br>
                • 컬럼 부피: ${columnVolume_L.toFixed(2)} L<br>
                • 권장 직경: ${(diameter * 100).toFixed(1)} cm<br>
                • 권장 높이: ${(height * 100).toFixed(1)} cm<br>
                • 예상 공정시간: ${processTime.toFixed(1)}시간<br>
                • 최대 압력: ${(height * 100 * 0.1).toFixed(1)} bar
            `;
            
            document.getElementById('columnResult').innerHTML = result;
            document.getElementById('columnResult').style.display = 'block';
        }

        function calculateEmptyFull() {
            const initialFull = parseFloat(document.getElementById('initialFull').value);
            const efficiency = parseFloat(document.getElementById('separationEfficiency').value);
            const recovery = parseFloat(document.getElementById('recoveryYield').value);
            
            const emptyRemoved = (100 - initialFull) * efficiency / 100;
            const finalEmpty = (100 - initialFull) - emptyRemoved;
            const finalFull = 100 - finalEmpty;
            const finalRecovery = recovery / 100;
            
            const result = `
                <strong>분리 결과 예측:</strong><br>
                • 초기 Full capsid: ${initialFull}%<br>
                • 최종 Full capsid: ${finalFull.toFixed(1)}%<br>
                • Empty capsid 제거율: ${emptyRemoved.toFixed(1)}%<br>
                • 전체 회수율: ${recovery}%<br>
                • 실제 Full capsid 회수: ${(finalFull * finalRecovery).toFixed(1)}%<br>
                • 품질 개선도: ${(finalFull / initialFull).toFixed(1)}배
            `;
            
            document.getElementById('emptyFullResult').innerHTML = result;
            document.getElementById('emptyFullResult').style.display = 'block';
        }

        function calculateTiter() {
            const ct = parseFloat(document.getElementById('ctValue').value);
            const slope = parseFloat(document.getElementById('slope').value);
            const intercept = parseFloat(document.getElementById('intercept').value);
            const dilution = parseFloat(document.getElementById('dilution').value);
            
            // Calculate log concentration from standard curve
            const logConc = (intercept - ct) / (-slope);
            const concentration = Math.pow(10, logConc);
            const finalTiter = concentration * dilution;
            
            const result = `
                <strong>역가 계산 결과:</strong><br>
                • Ct 값: ${ct}<br>
                • 표준곡선 농도: ${concentration.toExponential(2)} copies/μL<br>
                • 희석 보정: ×${dilution}<br>
                • 최종 역가: ${finalTiter.toExponential(2)} GC/mL<br>
                • Log 역가: ${Math.log10(finalTiter).toFixed(1)} log GC/mL<br>
                • 품질 평가: ${finalTiter > 1e13 ? '우수' : finalTiter > 1e12 ? '양호' : '개선 필요'}
            `;
            
            document.getElementById('titerResult').innerHTML = result;
            document.getElementById('titerResult').style.display = 'block';
        }

        function calculateStability() {
            const initialTiter = parseFloat(document.getElementById('initialTiter').value);
            const temp = parseFloat(document.getElementById('storageTemp').value);
            const period = parseFloat(document.getElementById('storagePeriod').value);
            
            // Simplified degradation model based on temperature
            let degradationRate = 0;
            switch(temp) {
                case -80:
                    degradationRate = 0.001; // Very stable
                    break;
                case -20:
                    degradationRate = 0.01;
                    break;
                case 4:
                    degradationRate = 0.05;
                    break;
                case 25:
                    degradationRate = 0.2;
                    break;
            }
            
            const finalTiter = initialTiter - (degradationRate * period);
            const stability = ((finalTiter / initialTiter) * 100).toFixed(1);
            
            const result = `
                <strong>안정성 예측:</strong><br>
                • 초기 역가: ${initialTiter} log GC/mL<br>
                • 보관 조건: ${temp}°C, ${period}개월<br>
                • 예상 최종 역가: ${finalTiter.toFixed(1)} log GC/mL<br>
                • 잔존 활성: ${stability}%<br>
                • 안정성 평가: ${stability > 90 ? '우수' : stability > 80 ? '양호' : '불안정'}<br>
                • 권장사항: ${temp > -20 ? '더 낮은 온도 보관 권장' : '현재 조건 유지'}
            `;
            
            document.getElementById('stabilityResult').innerHTML = result;
            document.getElementById('stabilityResult').style.display = 'block';
        }

        function calculateFacility() {
            const batches = parseFloat(document.getElementById('annualBatches').value);
            const cycleTime = parseFloat(document.getElementById('batchCycleTime').value);
            const lines = parseFloat(document.getElementById('parallelLines').value);
            const batchSize = parseFloat(document.getElementById('facilityBatchSize').value);
            
            const totalTime = batches * cycleTime;
            const requiredCapacity = totalTime / (365 * 0.8); // 80% utilization
            const actualLines = Math.max(lines, Math.ceil(requiredCapacity));
            const facilityArea = actualLines * 500 + 1000; // 500m² per line + 1000m² support
            const investment = facilityArea * 5000; // $5000 per m²
            
            const result = `
                <strong>시설 요구사항:</strong><br>
                • 연간 총 운영시간: ${totalTime}일<br>
                • 필요 생산라인: ${actualLines}개<br>
                • 총 시설 면적: ${facilityArea.toLocaleString()} m²<br>
                • 예상 투자비: ${(investment/1000000).toFixed(1)}M<br>
                • 연간 생산능력: ${(actualLines * 365 * 0.8 / cycleTime).toFixed(0)}배치<br>
                • 가동률: ${(batches / (actualLines * 365 * 0.8 / cycleTime) * 100).toFixed(1)}%
            `;
            
            document.getElementById('facilityResult').innerHTML = result;
            document.getElementById('facilityResult').style.display = 'block';
        }

        function calculateCpk() {
            const mean = parseFloat(document.getElementById('processMean').value);
            const std = parseFloat(document.getElementById('processStd').value);
            const lsl = parseFloat(document.getElementById('lsl').value);
            const usl = parseFloat(document.getElementById('usl').value);
            
            const cp = (usl - lsl) / (6 * std);
            const cpk = Math.min((usl - mean) / (3 * std), (mean - lsl) / (3 * std));
            const ppk = cpk; // Simplified
            
            let capability = '';
            if (cpk >= 1.67) capability = '우수 (6σ)';
            else if (cpk >= 1.33) capability = '양호 (4σ)';
            else if (cpk >= 1.0) capability = '보통 (3σ)';
            else capability = '부족 (개선 필요)';
            
            const result = `
                <strong>공정 능력 평가:</strong><br>
                • Cp (공정 잠재능력): ${cp.toFixed(2)}<br>
                • Cpk (공정 성능지수): ${cpk.toFixed(2)}<br>
                • 능력 평가: ${capability}<br>
                • 불량률 예상: ${cpk > 1.33 ? '<64 ppm' : cpk > 1.0 ? '<2700 ppm' : '>2700 ppm'}<br>
                • 권장사항: ${cpk < 1.33 ? '공정 개선 필요' : '현재 수준 유지'}
            `;
            
            document.getElementById('cpkResult').innerHTML = result;
            document.getElementById('cpkResult').style.display = 'block';
        }

        function calculateROI() {
            const batches = parseFloat(document.getElementById('sensorBatches').value);
            const batchValue = parseFloat(document.getElementById('batchValue').value);
            const reduction = parseFloat(document.getElementById('failureReduction').value);
            const cost = parseFloat(document.getElementById('sensorCost').value);
            
            const annualSavings = batches * batchValue * (reduction / 100);
            const roi = ((annualSavings - cost) / cost * 100);
            const payback = cost / annualSavings;
            
            const result = `
                <strong>센서 투자 ROI:</strong><br>
                • 연간 예상 절약: ${(annualSavings/1000).toFixed(0)}K<br>
                • 투자 회수 기간: ${payback.toFixed(1)}년<br>
                • 연간 ROI: ${roi.toFixed(0)}%<br>
                • 5년 누적 절약: ${(annualSavings*5/1000000).toFixed(1)}M<br>
                • 투자 권장: ${roi > 50 ? '강력 추천' : roi > 20 ? '추천' : '신중 검토'}
            `;
            
            document.getElementById('roiResult').innerHTML = result;
            document.getElementById('roiResult').style.display = 'block';
        }

        function predictHarvest() {
            const density = parseFloat(document.getElementById('aiCellDensity').value);
            const viability = parseFloat(document.getElementById('aiViability').value);
            const glucose = parseFloat(document.getElementById('aiGlucose').value);
            const postInfection = parseFloat(document.getElementById('aiPostInfection').value);
            
            // Simplified AI prediction model
            let score = 0;
            score += density > 2.0 ? 10 : 5;
            score += viability > 90 ? 10 : viability > 80 ? 5 : 0;
            score += glucose < 2.0 ? 10 : glucose < 5.0 ? 5 : 0;
            score += postInfection > 72 ? 10 : postInfection > 48 ? 5 : 0;
            
            const optimalHarvest = postInfection + (40 - score/2);
            const yieldPrediction = score > 30 ? '높음' : score > 20 ? '중간' : '낮음';
            
            const result = `
                <strong>AI 예측 결과:</strong><br>
                • 배양 건강도 점수: ${score}/40<br>
                • 최적 Harvest 시점: ${optimalHarvest.toFixed(0)}시간 후<br>
                • 예상 수율: ${yieldPrediction}<br>
                • 권장 조치: ${score < 20 ? '배양 조건 개선' : '정상 진행'}<br>
                • 신뢰도: ${score > 25 ? '높음' : '중간'}<br>
                • 알림: ${optimalHarvest - postInfection < 12 ? '곧 Harvest 준비' : '계속 모니터링'}
            `;
            
            document.getElementById('aiPredictionResult').innerHTML = result;
            document.getElementById('aiPredictionResult').style.display = 'block';
        }

        function calculateCapsidROI() {
            const devCost = parseFloat(document.getElementById('developmentCost').value);
            const efficiency = parseFloat(document.getElementById('efficiencyGain').value);
            const marketSize = parseFloat(document.getElementById('marketSize').value);
            const share = parseFloat(document.getElementById('marketShare').value);
            
            const revenue = marketSize * share / 100;
            const additionalRevenue = revenue * (efficiency - 1) / efficiency;
            const roi = ((additionalRevenue - devCost) / devCost * 100);
            const payback = devCost / additionalRevenue;
            
            const result = `
                <strong>캡시드 개발 ROI:</strong><br>
                • 예상 매출: ${revenue.toFixed(0)}M<br>
                • 추가 매출 (효율개선): ${additionalRevenue.toFixed(0)}M<br>
                • 투자 회수 기간: ${payback.toFixed(1)}년<br>
                • ROI: ${roi.toFixed(0)}%<br>
                • 개발 권장도: ${roi > 200 ? '매우 높음' : roi > 100 ? '높음' : '보통'}
            `;
            
            document.getElementById('capsidROIResult').innerHTML = result;
            document.getElementById('capsidROIResult').style.display = 'block';
        }

        function calculateContinuous() {
            const batchYield = parseFloat(document.getElementById('batchYield').value);
            const contYield = parseFloat(document.getElementById('continuousYield').value);
            const uptime = parseFloat(document.getElementById('uptimeImprovement').value);
            const capex = parseFloat(document.getElementById('capexIncrease').value);
            
            const yieldGain = contYield / batchYield;
            const productivityGain = yieldGain * (1 + uptime/100);
            const costReduction = 1 - (1 / productivityGain);
            const paybackYears = (capex/100) / costReduction;
            
            const result = `
                <strong>연속공정 경제성:</strong><br>
                • 수율 개선: ${yieldGain.toFixed(1)}배<br>
                • 생산성 향상: ${productivityGain.toFixed(1)}배<br>
                • 비용 절감: ${(costReduction*100).toFixed(0)}%<br>
                • 투자 회수: ${paybackYears.toFixed(1)}년<br>
                • 권장도: ${paybackYears < 3 ? '강력 추천' : paybackYears < 5 ? '추천' : '신중 검토'}
            `;
            
            document.getElementById('continuousResult').innerHTML = result;
            document.getElementById('continuousResult').style.display = 'block';
        }

        function predictCostReduction() {
            const currentCost = parseFloat(document.getElementById('currentCost').value);
            const year = parseInt(document.getElementById('targetYear').value);
            const adoption = parseFloat(document.getElementById('adoptionRate').value);
            
            const yearsFromNow = year - 2025;
            let reductionRate = 0;
            
            // Technology-driven cost reduction rates
            switch(year) {
                case 2026:
                    reductionRate = 0.15; // 15% reduction
                    break;
                case 2028:
                    reductionRate = 0.40; // 40% reduction
                    break;
                case 2030:
                    reductionRate = 0.70; // 70% reduction
                    break;
            }
            
            const adjustedReduction = reductionRate * (adoption / 100);
            const predictedCost = currentCost * (1 - adjustedReduction);
            const savings = currentCost - predictedCost;
            
            const result = `
                <strong>${year}년 비용 예측:</strong><br>
                • 현재 비용: ${(currentCost/1000).toFixed(0)}K/dose<br>
                • 예상 비용: ${(predictedCost/1000).toFixed(0)}K/dose<br>
                • 절감 금액: ${(savings/1000).toFixed(0)}K/dose<br>
                • 절감률: ${(adjustedReduction*100).toFixed(0)}%<br>
                • 기술 기여: ${reductionRate > 0.5 ? '혁신적' : reductionRate > 0.3 ? '상당함' : '점진적'}<br>
                • 달성 가능성: ${adoption > 80 ? '높음' : adoption > 60 ? '중간' : '낮음'}
            `;
            
            document.getElementById('costPredictionResult').innerHTML = result;
            document.getElementById('costPredictionResult').style.display = 'block';
        }

        function calculateEconomics() {
            const batchSize = parseFloat(document.getElementById('batchSize').value);
            const yield_val = parseFloat(document.getElementById('yield').value);
            const batchCost = parseFloat(document.getElementById('batchCost').value);
            const patientDose = parseFloat(document.getElementById('patientDose').value);
            
            const totalGC = batchSize * 1000 * yield_val; // Convert L to mL
            const patientsPerBatch = totalGC / patientDose;
            const costPerPatient = batchCost / patientsPerBatch;
            const costPerGC = batchCost / totalGC;
            
            const result = `
                <strong>경제성 분석 결과:</strong><br>
                • 배치당 총 생산량: ${totalGC.toExponential(2)} GC<br>
                • 배치당 환자 수: ${patientsPerBatch.toFixed(1)}명<br>
                • 환자당 제조비용: ${costPerPatient.toLocaleString()}<br>
                • GC당 비용: ${(costPerGC * 1e12).toFixed(2)}/10¹² GC<br>
                • 경제성 평가: ${costPerPatient > 100000 ? '개선 필요' : costPerPatient > 50000 ? '보통' : '우수'}
            `;
            
            document.getElementById('economicsResult').innerHTML = result;
            document.getElementById('economicsResult').style.display = 'block';
        }

        function troubleshoot() {
            const problemType = document.getElementById('problemType').value;
            const stage = document.getElementById('problemStage').value;
            
            let solutions = '';
            
            if (problemType === 'low_yield') {
                if (stage === 'upstream') {
                    solutions = `
                        <strong>낮은 수율 해결방안 (상류공정):</strong><br>
                        • Transfection 효율 확인 및 최적화<br>
                        • 플라스미드 품질 및 비율 재검토<br>
                        • 세포 건강도 및 배양 조건 점검<br>
                        • MOI 최적화 (Baculovirus 시스템)<br>
                        • Harvest 시점 재평가
                    `;
                } else {
                    solutions = `
                        <strong>낮은 수율 해결방안 (하류공정):</strong><br>
                        • 각 정제 단계별 수율 추적<br>
                        • 용해 조건 최적화<br>
                        • 크로마토그래피 조건 재검토<br>
                        • TFF 막 fouling 점검<br>
                        • 온도 및 pH 조건 확인
                    `;
                }
            } else if (problemType === 'high_empty') {
                solutions = `
                    <strong>높은 Empty capsid 해결방안:</strong><br>
                    • Rep/Cap 플라스미드 비율 조정<br>
                    • 온도 shift 타이밍 최적화<br>
                    • AEX 조건으로 Empty/Full 분리<br>
                    • 배양 시간 단축 검토<br>
                    • ITR 무결성 확인
                `;
            } else if (problemType === 'contamination') {
                solutions = `
                    <strong>오염 해결방안:</strong><br>
                    • 환경 모니터링 강화<br>
                    • 무균 조작 절차 재검토<br>
                    • 장비 세척 validation<br>
                    • 원료 무균성 확인<br>
                    • 인력 재교육 실시
                `;
            } else if (problemType === 'aggregation') {
                solutions = `
                    <strong>응집 해결방안:</strong><br>
                    • 제형 buffer 최적화<br>
                    • 농축 조건 완화<br>
                    • 온도 관리 강화<br>
                    • 교반 속도 조정<br>
                    • 동결해동 조건 개선
                `;
            } else {
                solutions = `
                    <strong>낮은 회수율 해결방안:</strong><br>
                    • 각 단계별 손실 분석<br>
                    • 장비 세척 효율 확인<br>
                    • Hold time 최소화<br>
                    • 배관 Dead volume 점검<br>
                    • 샘플링 절차 개선
                `;
            }
            
            document.getElementById('troubleshootResult').innerHTML = solutions;
            document.getElementById('troubleshootResult').style.display = 'block';
        }

        function analyzeProduct() {
            const product = document.getElementById('productSelect').value;
            const analysisType = document.getElementById('analysisType').value;
            
            const productData = {
                zolgensma: {
                    technical: "AAV9 벡터, SMN1 유전자 탑재, 단회 투여, BBB 투과성 우수",
                    clinical: "운동 기능 개선 90%, 2년 생존율 100%, 호흡 지원 불필요 85%",
                    manufacturing: "Novartis 대규모 시설, suspension culture, 연간 200+ dose 생산 가능",
                    regulatory: "FDA Breakthrough Therapy, Orphan Drug, 우선심사로 빠른 승인",
                    commercial: "$2.1M/dose, 보험 적용률 95%, 전 세계 1,000+ 환자 치료"
                },
                luxturna: {
                    technical: "AAV2 벡터, RPE65 유전자, 직접 안구내 주사, 망막 특이성",
                    clinical: "시력 개선 65%, 기능적 시야 확대, 3년 지속 효과 확인",
                    manufacturing: "Spark/Roche 제조, 소규모 생산, 연간 100 dose 수준",
                    regulatory: "FDA 첫 AAV 승인, Orphan Drug, 획기적 치료제 지정",
                    commercial: "$425K/dose, 제한적 환자군 (1,000-2,000명), 90% 보험 적용"
                },
                glybera: {
                    technical: "AAV1 벡터, LPL 유전자, 근육내 다중 주사, 발현 수준 낮음",
                    clinical: "혈중 중성지방 감소 50%, 개선 효과 일시적, 재투여 필요",
                    manufacturing: "uniQure 소규모 생산, 복잡한 다중 주사 공정",
                    regulatory: "EMA 조건부 승인, 복잡한 환자 선정 기준, 추가 연구 요구",
                    commercial: "$1.2M/dose, 5년간 1명 치료, 상업적 실패로 시장 철수"
                },
                hemgenix: {
                    technical: "AAV5 벡터, Factor IX 유전자, 간 특이성, 단회 정맥 투여",
                    clinical: "출혈 에피소드 64% 감소, Factor IX 활성 지속적 증가",
                    manufacturing: "CSL Behring, 검증된 AAV5 플랫폼, 안정적 공급",
                    regulatory: "FDA 신속 승인, Orphan Drug, 혈우병B 최초 유전자치료",
                    commercial: "$3.5M/dose, 보험 적용 협상 중, 연간 100+ 환자 대상"
                },
                roctavian: {
                    technical: "AAV5 벡터, Factor VIII 유전자, 간 표적, 높은 면역원성",
                    clinical: "출혈률 감소 but 효과 감소 시간 경과, 개인차 큼",
                    manufacturing: "BioMarin 전용 시설, 복잡한 대용량 생산",
                    regulatory: "EU 조건부 승인, FDA 추가 데이터 요구로 지연",
                    commercial: "$2.9M/dose, 제한적 시장 접근, 장기 효능 우려"
                }
            };
            
            const data = productData[product];
            const result = `
                <strong>${product.toUpperCase()} - ${analysisType} 분석:</strong><br>
                ${data[analysisType]}<br><br>
                <strong>핵심 인사이트:</strong><br>
                ${analysisType === 'commercial' ? 
                    (product === 'zolgensma' ? '높은 가격에도 강력한 임상 효과로 성공' :
                     product === 'glybera' ? '기술적 성공이 상업적 성공을 보장하지 않음' :
                     '적절한 가격 정책과 보험 적용이 중요') :
                 analysisType === 'technical' ?
                    '벡터 설계와 전달 방식이 치료 효과를 결정' :
                 analysisType === 'clinical' ?
                    '명확한 임상 endpoint와 장기 효능 데이터 필수' :
                 '조기 규제 기관 소통과 특별 프로그램 활용이 핵심'}
            `;
            
            document.getElementById('productAnalysisResult').innerHTML = result;
            document.getElementById('productAnalysisResult').style.display = 'block';
        }

        function updateWeights() {
            const tech = document.getElementById('techWeight').value;
            const clinical = document.getElementById('clinicalWeight').value;
            const manuf = document.getElementById('manufWeight').value;
            const market = document.getElementById('marketWeight').value;
            
            document.getElementById('techValue').textContent = tech + '%';
            document.getElementById('clinicalValue').textContent = clinical + '%';
            document.getElementById('manufValue').textContent = manuf + '%';
            document.getElementById('marketValue').textContent = market + '%';
            
            const total = parseInt(tech) + parseInt(clinical) + parseInt(manuf) + parseInt(market);
            document.getElementById('totalWeight').textContent = total + '%';
            document.getElementById('totalWeight').style.color = total === 100 ? 'green' : 'red';
        }

        function calculateSuccess() {
            const tech = parseFloat(document.getElementById('techWeight').value);
            const clinical = parseFloat(document.getElementById('clinicalWeight').value);
            const manuf = parseFloat(document.getElementById('manufWeight').value);
            const market = parseFloat(document.getElementById('marketWeight').value);
            
            const total = tech + clinical + manuf + market;
            
            if (total !== 100) {
                alert('가중치 총합이 100%가 되어야 합니다.');
                return;
            }
            
            // Sample scores for different products (0-100 scale)
            const productScores = {
                zolgensma: {tech: 85, clinical: 95, manuf: 80, market: 70},
                luxturna: {tech: 80, clinical: 75, manuf: 70, market: 65},
                glybera: {tech: 70, clinical: 60, manuf: 50, market: 20},
                hemgenix: {tech: 85, clinical: 85, manuf: 85, market: 75},
                roctavian: {tech: 75, clinical: 65, manuf: 75, market: 50}
            };
            
            let resultHTML = '<strong>제품별 성공 점수:</strong><br>';
            
            Object.keys(productScores).forEach(product => {
                const scores = productScores[product];
                const weightedScore = (scores.tech * tech + scores.clinical * clinical + 
                                    scores.manuf * manuf + scores.market * market) / 100;
                
                resultHTML += `• ${product.toUpperCase()}: ${weightedScore.toFixed(1)}점<br>`;
            });
            
            resultHTML += '<br><strong>분석:</strong><br>';
            resultHTML += '점수가 높을수록 성공 가능성이 높으며, 각 요인의 가중치에 따라 순위가 변경됩니다.';
            
            document.getElementById('successResult').innerHTML = resultHTML;
            document.getElementById('successResult').style.display = 'block';
        }

        function getRegulatory() {
            const stage = document.getElementById('devStage').value;
            const market = document.getElementById('targetMarket').value;
            const indication = document.getElementById('indicationType').value;
            
            let pathway = '';
            let timeline = '';
            let requirements = '';
            
            if (market === 'us') {
                if (indication === 'rare') {
                    pathway = 'FDA Orphan Drug + Breakthrough Therapy 병행 신청 권장';
                    timeline = 'IND 승인: 30일, BLA 심사: 6-12개월';
                    requirements = 'Phase 2 효능 데이터, 자연사 연구, 소규모 임상 허용';
                } else {
                    pathway = 'FDA 표준 경로, Fast Track 고려';
                    timeline = 'IND 승인: 30일, BLA 심사: 10-12개월';
                    requirements = 'Phase 3 대조군 시험, 대규모 안전성 데이터';
                }
            } else if (market === 'eu') {
                if (indication === 'rare') {
                    pathway = 'EMA PRIME + Orphan Designation';
                    timeline = 'CTA 승인: 60일, MAA 심사: 150-210일';
                    requirements = 'Scientific Advice 필수, ATMP 가이드라인 준수';
                } else {
                    pathway = 'EMA 표준 ATMP 심사';
                    timeline = 'CTA 승인: 60일, MAA 심사: 210일';
                    requirements = '포괄적 임상 데이터, 장기 추적 계획';
                }
            } else if (market === 'global') {
                pathway = 'FDA-EMA 동시 상담, ICH 가이드라인 준수';
                timeline = '각 지역별 요구사항 조화, 18-24개월 소요';
                requirements = '국제 공통 임상 프로토콜, 글로벌 CMC 전략';
            }
            
            const result = `
                <strong>추천 규제 경로:</strong><br>
                ${pathway}<br><br>
                <strong>예상 타임라인:</strong><br>
                ${timeline}<br><br>
                <strong>주요 요구사항:</strong><br>
                ${requirements}<br><br>
                <strong>다음 단계:</strong><br>
                • Pre-IND/Scientific Advice 미팅 신청<br>
                • 임상 프로토콜 초안 작성<br>
                • CMC 개발 계획 수립
            `;
            
            document.getElementById('regulatoryResult').innerHTML = result;
            document.getElementById('regulatoryResult').style.display = 'block';
        }

        function searchTerms() {
            const query = document.getElementById('termSearch').value.toLowerCase();
            const resultsDiv = document.getElementById('termResults');
            
            if (query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }
            
            const filteredTerms = glossaryData.filter(item => 
                item.term.toLowerCase().includes(query) || 
                item.english.toLowerCase().includes(query) ||
                item.definition.toLowerCase().includes(query)
            );
            
            if (filteredTerms.length > 0) {
                let html = '<div style="background: white; border: 1px solid #ccc; border-radius: 4px; padding: 1rem;">';
                filteredTerms.forEach(term => {
                    html += `
                        <div style="margin-bottom: 1rem; padding: 0.5rem; border-bottom: 1px solid #eee;">
                            <strong>${term.term}</strong> (${term.english})<br>
                            <em>${term.definition}</em><br>
                            <small style="color: #666;">분야: ${term.category}</small>
                        </div>
                    `;
                });
                html += '</div>';
                resultsDiv.innerHTML = html;
                resultsDiv.style.display = 'block';
            } else {
                resultsDiv.innerHTML = '<div style="padding: 1rem; color: #666;">검색 결과가 없습니다.</div>';
                resultsDiv.style.display = 'block';
            }
        }

        function convertUnits() {
            const inputValue = parseFloat(document.getElementById('inputValue').value);
            const inputUnit = document.getElementById('inputUnit').value;
            const outputUnit = document.getElementById('outputUnit').value;
            
            if (isNaN(inputValue)) {
                alert('올바른 숫자를 입력하세요.');
                return;
            }
            
            // Conversion factors (approximate)
            const conversionTable = {
                'gc_ml': 1,
                'vp_ml': 10, // Assume 10:1 VP:GC ratio due to empty capsids
                'iu_ml': 0.001, // Assume 1:1000 IU:GC ratio
                'log_gc': 1, // Special case
                'particles_ml': 10
            };
            
            let result = 0;
            
            if (inputUnit === 'log_gc' && outputUnit !== 'log_gc') {
                const gcValue = Math.pow(10, inputValue);
                result = gcValue / conversionTable[outputUnit];
            } else if (inputUnit !== 'log_gc' && outputUnit === 'log_gc') {
                const gcValue = inputValue * conversionTable[inputUnit];
                result = Math.log10(gcValue);
            } else if (inputUnit === 'log_gc' && outputUnit === 'log_gc') {
                result = inputValue;
            } else {
                const gcValue = inputValue * conversionTable[inputUnit];
                result = gcValue / conversionTable[outputUnit];
            }
            
            const unitNames = {
                'gc_ml': 'GC/mL',
                'vp_ml': 'VP/mL',
                'iu_ml': 'IU/mL',
                'log_gc': 'log GC/mL',
                'particles_ml': 'particles/mL'
            };
            
            const resultText = `
                <strong>단위 변환 결과:</strong><br>
                ${inputValue.toLocaleString()} ${unitNames[inputUnit]} = 
                ${result < 1000 ? result.toFixed(3) : result.toExponential(2)} ${unitNames[outputUnit]}<br><br>
                <small>* 변환 계수는 근사값이며, 실제 값은 벡터 특성에 따라 다를 수 있습니다.</small>
            `;
            
            document.getElementById('conversionResult').innerHTML = resultText;
            document.getElementById('conversionResult').style.display = 'block';
        }

        function provideFeedback() {
            const feedbackModal = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; display: flex; align-items: center; justify-content: center;" id="feedbackModal">
                    <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">📝 피드백 제공</h3>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">피드백 유형:</label>
                            <select id="feedbackType" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="link">링크 오류 신고</option>
                                <option value="content">내용 개선 제안</option>
                                <option value="update">최신 정보 제보</option>
                                <option value="general">일반 의견</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">관련 챕터:</label>
                            <select id="feedbackChapter" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="all">전체</option>
                                <option value="intro">서론</option>
                                <option value="design">벡터 설계</option>
                                <option value="upstream">상류공정</option>
                                <option value="downstream">하류공정</option>
                                <option value="quality">품질관리</option>
                                <option value="gmp">GMP & 스케일업</option>
                                <option value="automation">자동화 & PAT</option>
                                <option value="future">미래 전망</option>
                                <option value="casestudy">사례 연구</option>
                                <option value="regulatory">규제 가이드</option>
                                <option value="tools">실무 도구</option>
                                <option value="appendix">부록</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">상세 내용:</label>
                            <textarea id="feedbackContent" style="width: 100%; height: 120px; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; resize: vertical;" placeholder="구체적인 피드백을 입력해 주세요..."></textarea>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">연락처 (선택):</label>
                            <input type="email" id="feedbackEmail" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;" placeholder="답변이 필요한 경우 이메일 주소를 입력해 주세요">
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="submitFeedback()" style="margin-right: 1rem;">제출</button>
                            <button class="btn" onclick="closeFeedback()">취소</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', feedbackModal);
        }

        function submitFeedback() {
            const type = document.getElementById('feedbackType').value;
            const chapter = document.getElementById('feedbackChapter').value;
            const content = document.getElementById('feedbackContent').value;
            const email = document.getElementById('feedbackEmail').value;
            
            if (!content.trim()) {
                alert('피드백 내용을 입력해 주세요.');
                return;
            }
            
            // 실제 구현에서는 서버로 데이터 전송
            const feedbackData = {
                type: type,
                chapter: chapter,
                content: content,
                email: email,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent
            };
            
            console.log('Feedback submitted:', feedbackData);
            
            // 시뮬레이션된 성공 메시지
            alert('소중한 피드백을 보내주셔서 감사합니다!\n\n검토 후 교재 개선에 반영하겠습니다.\n연락처를 남겨주신 경우 답변을 드리겠습니다.');
            
            closeFeedback();
        }

        function closeFeedback() {
            const modal = document.getElementById('feedbackModal');
            if (modal) {
                modal.remove();
            }
        }

        // Auto-save functionality (using variables instead of localStorage)
        setInterval(function() {
            // Auto-save progress, bookmarks, and notes to variables
            console.log('Auto-saving progress...', {
                readChapters: Array.from(readChapters),
                bookmarks: Array.from(bookmarks),
                notes: notes
            });
        }, 30000); // Save every 30 seconds
    </script>
</body>
</html>
